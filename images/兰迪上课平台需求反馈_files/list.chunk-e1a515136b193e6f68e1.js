webpackJsonp([5],{1020:function(e,t,n){function r(e){return new Promise(function(t,n){(0,s.ajaxGet)("/smapi/files/"+e).then(function(e){0===e.code?t(e.data):n(new Error(e.message))},function(e){n(e)})})}function i(){return new Promise(function(e,t){(0,s.ajaxGet)("/smapi/teams/mine/invite_state").then(function(n){if(0===n.code){var r=n.data.inviteGuid||"";if(r){var i=window.location.protocol+"//"+window.location.host+"/company/invite/"+r;e(i)}else e("")}else t()},function(e){t(e)})})}function a(){return new Promise(function(e,t){(0,s.ajaxDelete)("/smapi/teams/mine/invite_state").then(function(){e("")},function(e){t(e)})})}function o(){return new Promise(function(e,t){(0,s.ajaxPost)("/smapi/teams/mine/invite_state",{}).then(function(n){if(0===n.code){var r=n.data.inviteGuid;if(r){var i=window.location.protocol+"//"+window.location.host+"/company/invite/"+r;e(i)}else e("")}else t()},function(e){t(e)})})}function l(e){return new Promise(function(t,n){(0,s.ajaxPost)("/teams/invite_members",{users:e.join(",")}).then(function(e){var n=0,r=0,i=[],a=[];for(var o in e.data.data)"string"==typeof e.data.data[o]?(r+=1,i.push(o),a.push(e.data.data[o])):n+=1;t({successedCount:n,failedCount:r,failedUsers:i,failedMessages:a})},function(e){n(e)})})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(22);t.default={getFileTeamInfo:r,getInviteLink:i,inviteMembers:l,closeInviteLink:a,openInviteLink:o},e.exports=t.default},1059:function(e,t,n){var r=n(0);e.exports=r.createClass({displayName:"exports",render:function(){var e={group:this.props.groupIndex,row:this.props.rowIndex};return r.createElement("div",{className:"ui-list-row",onClick:this._onClickRow},this.props.rowDom(e,this.props.rowItem))},_onClickRow:function(e){var t={group:this.props.groupIndex,row:this.props.rowIndex};this.props.onClickRow(e,t,this.props.rowItem)}})},1060:function(e,t,n){(function(r){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e}function c(e){return{dispatch:e}}function d(e,t,n){return r.assign({},n,e,t)}Object.defineProperty(t,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=n(0),m=a(h),v=n(268),y=n(1487),g=a(y),b=n(1496),_=a(b),w=n(1512),k=a(w),E=n(1518),C=a(E),T=n(544),O=a(T),P=n(252),S=n(151),D=n(1438),F=i(D),M=n(1519),I=a(M);(0,O.default)(),(0,C.default)();var L=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isScrolled:!1},n}return s(t,e),p(t,[{key:"componentDidMount",value:function(){var e=this,t=this.refs.listContainer;this.handleScroll=r.throttle(function(){e._handleScroll()},20),this.handleScrollForLoadingMore=r.debounce(function(){e._handleScrollForLoadMore()},300),t.addEventListener("scroll",this.handleScroll),t.addEventListener("scroll",this.handleScrollForLoadingMore),window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){var e=this.refs.listContainer;e.removeEventListener("scroll",this.handleScroll),e.removeventListener("scroll",this.handleScrollForLoadingMore),window.removeEventListener("resize",this.handleScroll)}},{key:"_handleScroll",value:function(){var e=this.refs.listContainer,t=e.scrollTop,n=e.scrollLeft,r=window.innerWidth,i=this.state.isScrolled,a={},o=!1;0===t||i?0===t&&i&&(a.isScrolled=!1,o=!0):(a.isScrolled=!0,o=!0),n!==this.state.scrollLeft&&r<=1176&&(a.scrollLeft=n,o=!0),this.winWidth<=1176&&r>1176&&(a.scrollLeft=-1,o=!0),this.winWidth=r,o&&this.setState(a)}},{key:"_handleScrollForLoadMore",value:function(){var e=this.refs.listContainer,t=this.props.list,n=t.loading,r=t.listType,i=t.recentHasNoMore;if("recent"===r&&!n&&!i&&e.scrollHeight-(e.scrollTop+e.clientHeight)<=10){var a=this.props.dispatch,o=this.props.list,l=o.pagination,s=o.pageSize;a(F.goNextPage(l+1,s))}}},{key:"render",value:function(){var e=this.props.dispatch,t=this.state,n=t.isScrolled,r=t.scrollLeft,i=this.props.list,a=i.files,o=i.orderedFiles,l=i.loading,s=i.loaded,u=i.isMoving,c=i.currentUser,d=i.gridMode,p=i.orderRule,h=i.listType,v=i.currentFile,y=i.isDragToCrumb,b=i.alphaFeatures,w=i.pagination,E=[];E="recent"!==h&&"table"===d?o:a;var C=(0,S.bindActionCreators)(F,this.props.dispatch);return m.default.createElement("div",{className:"list-container fix",ref:"listContainer"},m.default.createElement(g.default,{scrollLeft:r,isScrolled:n,listType:h,gridMode:d,currentFile:v,isMoving:u,files:a,loaded:s,enableDrop:u,dispatch:e,alphaFeatures:b,orderRule:p}),m.default.createElement(_.default,{listType:h,gridMode:d,dispatch:e,files:E,loading:l,loaded:s,pagination:w,isDragToCrumb:y,isMoving:u,currentFile:v}),m.default.createElement(k.default,{scrollLeft:r,alphaFeatures:b,enableDrop:u,loaded:s,listType:h,currentFile:v,currentUser:c,files:a,dispatch:e}),m.default.createElement(P.ModalRoot,f({},this.props,C)),m.default.createElement(I.default,null))}}]),t}(h.Component);L.propTypes={list:h.PropTypes.object.isRequired,dispatch:h.PropTypes.func.isRequired};var x=(0,v.connect)(u,c,d,{withRef:!0})(L);t.default={List:L,ListContainer:x},e.exports=t.default}).call(t,n(1))},1061:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(13),l=r(o),s=n(268),u=n(1521),c=r(u),d=n(33),f=r(d),p=n(1442),h=r(p),m=n(5),v=r(m),y=n(579),g=r(y);(0,r(n(1523)).default)(c.default),t.default=function(e){var t=e.ListContainer,n=e.guid,r=e.isAjaxForce,i={listWrap:document.getElementById("list-view")};c.default.dispatch(h.default.getList(n,r)).then(function(e){g.default.inc(),window.cow.currentFile=e;var n=e.pageTitle||"石墨文档";"home"===cow.pageType?n="石墨文档":"folder"===cow.pageType&&(n=cow.currentFile.name),document.title=n,f.default.getConnectSocket().then(function(){window.cow.listApp||(window.cow.listApp=l.default.render(a.default.createElement(s.Provider,{store:c.default},a.default.createElement(t,null)),i.listWrap)),g.default.done()}).catch(function(e){setTimeout(function(){g.default.done(),v.default.alert({title:e?e.message:"加载出错"})},0)})})},e.exports=t.default},1073:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(54),d=n(1166),f=r(d),p=n(323),h=r(p),m=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={me:n._filterMeFromUserList(e.userList)},n}return o(t,e),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=this._filterMeFromUserList(e.userList);this.setState({me:t})}},{key:"_filterMeFromUserList",value:function(e){var t=null;return e.some(function(e){return!!h.default.isSameUser(e,cow.currentUser)&&(t=e,!0)}),t}},{key:"_getProps",value:function(){var e=this.props,t={selectable:!!e.selectable,removeable:!!e.removeable,showRole:!!e.showRole,onChange:e.onChange||function(){},roleField:e.roleField||"role",userList:e.userList||[],customClass:e.customClass||"",groupBy:e.groupBy,headTag:e.headTag};return t.groupBy?(t.adapter={type:"group"},t.userList=this._groupUserList(t.groupBy)):t.headTag?(t.adapter={type:"group"},t.userList=[{name:t.headTag,items:t.userList}]):t.adapter={type:"plain"},t}},{key:"_groupUserList",value:function(){return[]}},{key:"_createListRowDom",value:function(e,t){var n=this.props.classPrefix;return u.default.createElement("div",{className:"share-user-li "+(n?n+"-user-li":"user-li")},u.default.createElement(c.ImageIcon,{customClass:"share-user-avatar avatar",defaultImg:"https://assets-cdn.shimo.im/assets/images/loading-b67e5a67dc.gif",realImg:t.avatar}),u.default.createElement("span",{className:"share-user-name ellipsis "+(n?n+"-user-name":"")},t.name),u.default.createElement("span",{className:"share-user-email ellipsis "+(n?n+"-user-email":"")},t.email),this._createRowActions.bind(this)(t))}},{key:"_createHeadDom",value:function(e,t){var n=t||"",r="";return this.props.classPrefix&&(r=this.props.classPrefix+"-li-title"),u.default.createElement("div",{className:"share-li-title "+r},n)}},{key:"_createRowActions",value:function(e){var t=this._getProps(),n=t.selectable,r=t.removeable,i=t.showRole,a=[];if(n){var o="";o=e.isShared?"is-shared":e.isChecked?"is-checked":"",e.isDisable&&(o+=" is-disable"),a.push(u.default.createElement("span",{key:a.length,className:"operation-icon doc-share-icon "+o}))}if(i){var l=!1;r&&(l=!!e.canBeRemove);var s="share-status share-user-identity "+(l?"share-show-remove":"")+(this.props.classPrefix?" "+this.props.classPrefix+"-user-identify":"");a.push(u.default.createElement("span",{key:a.length,className:s},"disable"===e.team_role?"已禁用":h.default.isCreator(e)?"创建者":"成员")),l&&a.push(u.default.createElement("span",{key:a.length,onClick:this._removeMember.bind(this,e),"data-user":a.length,className:"share-status share-user-remove doc-share-icon"}))}else r&&a.push(u.default.createElement("span",{key:a.length,className:"operation-icon doc-share-icon is-remove"}));return a}},{key:"_removeMember",value:function(e){(0,this._getProps().onChange)({type:"remove",user:e})}},{key:"_onRowClick",value:function(e,t,n){var r=this._getProps(),i=r.selectable,a=r.removeable,o=r.onChange;if(!r.showRole)if(i){if(n.isShared||n.isDisable)return;o({type:n.isChecked?"unSelect":"select",user:n})}else a&&o({type:"remove",user:n})}},{key:"_onHeadClick",value:function(){}},{key:"render",value:function(){var e=this._getProps(),t=e.userList,n=e.adapter;return u.default.createElement(f.default,{data:t,adapter:n,headDom:this._createHeadDom.bind(this),onClickRow:this._onRowClick.bind(this),onClickHead:this._onHeadClick.bind(this),rowDom:this._createListRowDom.bind(this)})}}]),t}(s.Component);t.default=m,m.propTypes={selectable:s.PropTypes.bool,removeable:s.PropTypes.bool,enableRowClick:s.PropTypes.bool,onChange:s.PropTypes.func,classPrefix:s.PropTypes.string,showRole:s.PropTypes.bool,roleField:s.PropTypes.string,userList:s.PropTypes.array,customClass:s.PropTypes.string,adapter:s.PropTypes.object},e.exports=t.default},1140:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(51),d=r(c),f=n(1163),p=r(f),h=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={open:e.open,inviteType:"link"},n}return o(t,e),l(t,null,[{key:"propTypes",get:function(){return{open:s.PropTypes.bool,onClose:s.PropTypes.func,title:s.PropTypes.string}}}]),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.open;void 0!==t&&t!==this.state.open&&t!==this.props.open&&this.setState({open:t})}},{key:"renderTitle",value:function(){var e=this.props.title;return e?u.default.createElement("div",{className:"invitation-content-title"},e):null}},{key:"bodyTpl",value:function(){var e=["link","email","recent"];return u.default.createElement("div",{className:"invitation-content-wrap"},this.renderTitle(),u.default.createElement(p.default,{showItems:e}))}},{key:"render",value:function(){return u.default.createElement(d.default,{customClass:"invitation-dialog add-member-dialog",ref:"flatDialog",hasCloseButton:!0,title:"",onClose:this.props.onClose,open:this.props.open,enableCloseClickMask:!0,bodyTpl:this.bodyTpl.bind(this)})}}]),t}(s.Component);t.default=h,e.exports=t.default},1163:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),d=n(54),f=n(1164),p=r(f),h=n(1165),m=r(h),v=n(5),y=r(v),g=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._result={},n._result.currentInfoList=[],n.onKeydown=n.onKeydown.bind(n),n.tabDidChange=n.tabDidChange.bind(n),n.tabWillChange=n.tabWillChange.bind(n),n}return l(t,e),s(t,[{key:"componentDidMount",value:function(){this.addEventListener(),this.isMac=y.default.isMac()}},{key:"componentWillUnmount",value:function(){this.removeEventListener()}},{key:"addEventListener",value:function(){document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListener",value:function(){document.removeEventListener("keydown",this.onKeydown)}},{key:"asCenter",value:function(){var e=document.getElementsByClassName("invitation-dialog")[0];e&&(e.style.marginLeft=-e.clientWidth/2+"px",e.style.marginTop=-e.clientHeight/2+"px")}},{key:"onKeydown",value:function(e){if(this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey){var t=document.getElementsByClassName("invitation-link-input")[0];t&&t.value&&(t.select(),67===e.keyCode&&y.default.alert({title:"链接已复制",delay:1500}))}}},{key:"_headTpl",value:function(e){return c.default.createElement("span",{className:""},e)}},{key:"tabWillChange",value:function(e,t){var n=this.props,r=n.onChange,i=n.showItems,a={type:"tabChange",data:i[t]};"function"==typeof r&&r(a),this._result[i[e]]=this._result.currentInfoList;var o=this._result[i[t]]||[];this._changeInviteList(o),"link"===i[t]?this.addEventListener():this.removeEventListener()}},{key:"tabDidChange",value:function(){this.asCenter()}},{key:"_changeInviteList",value:function(e){this._result.currentInfoList=[].concat(i(e));var t=this.props.onChange,n={type:"dataChange",data:e};"function"==typeof t&&t(n)}},{key:"_onEmailChange",value:function(e){this._changeInviteList(e)}},{key:"render",value:function(){var e=this,t=this.props.showItems,n=[];return(t||[]).forEach(function(t){"link"===t?n.push(c.default.createElement(d.TabItem,{key:"link",title:"邀请链接"},c.default.createElement(p.default,{asCenter:e.asCenter}))):"email"===t&&n.push(c.default.createElement(d.TabItem,{key:"email",title:"邮箱邀请"},c.default.createElement(m.default,{asCenter:e.asCenter})))}),c.default.createElement(d.Tab,{customClass:"sm-nav-tabs invitation-tabs large",disableSetWidth:!0,headTpl:this._headTpl,tabDidChange:this.tabDidChange,tabWillChange:this.tabWillChange},n)}}]),t}(u.Component);t.default=g,g.propTypes={showItems:u.PropTypes.arrayOf(u.PropTypes.oneOf(["link","email","recent"])),onChange:u.PropTypes.func},e.exports=t.default},1164:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(1020),d=r(c),f=n(327),p=r(f),h=n(5),m=r(h),v=n(20),y=r(v),g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={inviteLink:"",disabled:!0,isLoading:!0,copyStatus:""},n.toggleInviteLink=n.toggleInviteLink.bind(n),n}return o(t,e),l(t,[{key:"componentDidMount",value:function(){this.getInviteLink(),this.initCopy()}},{key:"getInviteLink",value:function(){var e=this;d.default.getInviteLink().then(function(t){t?e.setState({isLoading:!1,inviteLink:t,disabled:!1}):e.setState({isLoading:!1,disabled:!0})},function(){})}},{key:"initCopy",value:function(){var e=new p.default(this.refs.copyBtn);e.on("success",function(){m.default.alert({title:"链接已复制",delay:1500})}),e.on("error",function(){m.default.alert({title:"链接复制失败",delay:1500,type:"error"})})}},{key:"toggleInviteLink",value:function(){var e=this;this.state.disabled?d.default.openInviteLink().then(function(t){e.setState({inviteLink:t,disabled:!1})},function(){m.default.alert({title:"开启邀请链接失败",type:"error"})}):d.default.closeInviteLink().then(function(){e.setState({disabled:!0,inviteLink:""})},function(){m.default.alert({title:"关闭邀请链接失败",type:"error"})})}},{key:"storeRef",value:function(e){var t=this;return function(n){t[e]=n}}},{key:"renderDesc",value:function(){return this.state.disabled?u.default.createElement("div",{className:"invitation-link-desc"}," "):u.default.createElement("div",{className:"invitation-link-desc"},"收到邀请链接的人可以加入企业")}},{key:"render",value:function(){var e=this.state,t=e.inviteLink,n=e.disabled,r=e.copyStatus,i=e.isLoading,a=(0,y.default)({"sm-btn sm-btn-primary invitation-link-copy":!0,disable:n,"copy-unable":"unable"===r}),o=(0,y.default)({"invitation-link-line":!0,disable:n}),l=(0,y.default)({"sm-form-control invitation-link-input":!0,"copy-unable":"unable"===r}),s={height:"33px",minWidth:"110px",lineHeight:"32px"};return u.default.createElement("div",{className:"invitation-link-panel",style:{height:"142px",opacity:""+(i?0:1)}},u.default.createElement("div",{className:o},u.default.createElement("input",{className:l,readOnly:"readonly",placeholder:"邀请链接已关闭",disabled:n?"disabled":"",value:t}),this.state.disabled?u.default.createElement("a",{className:"close-invitation-link",onClick:this.toggleInviteLink},"开启链接"):u.default.createElement("a",{className:"close-invitation-link danger",onClick:this.toggleInviteLink},"关闭链接")),this.renderDesc(),u.default.createElement("div",{className:"invitation-panel-foot"},u.default.createElement("button",{ref:"copyBtn",style:s,"data-clipboard-action":"copy","data-clipboard-target":".invitation-link-input",className:a},"复制链接")))}}]),t}(s.Component);t.default=g,g.propTypes={asCenter:s.PropTypes.func},e.exports=t.default},1165:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=i(u),d=n(1073),f=i(d),p=n(323),h=i(p),m=n(1020),v=i(m),y=n(923),g=(i(y),n(5)),b=i(g),_=n(20),w=i(_),k=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={emailContent:"",type:"list",userList:[],newAddUserList:[],isSending:!1,inviteActionVisible:!0,keyword:"",isLoading:!0,errorList:[]},n.maxInviteCount=20,n.recentList=[],n.teamMembers=[],n.usersSearchCaches=[],n.onSearchInputChange=n.onSearchInputChange.bind(n),n.onSearchInputKeydown=n.onSearchInputKeydown.bind(n),n.onTextareaChange=n.onTextareaChange.bind(n),n.onSwitcherClick=n.onSwitcherClick.bind(n),n.onUserListChange=n.onUserListChange.bind(n),n.startInvite=n.startInvite.bind(n),n.search=r.debounce(n.search.bind(n),300),n.clear=n.clear.bind(n),n}return l(t,e),s(t,[{key:"componentDidMount",value:function(){this.preLoadData()}},{key:"preLoadData",value:function(){var e=this;Promise.all([this.getTeamMembers(),this.getRecentList()]).then(function(){e.recentList=e.recentList.filter(function(t){return e.teamMembers.every(function(e){return!h.default.isSameUser(e,t)})}),e.setState({isLoading:!1,userList:[].concat(e.recentList)})},function(e){console.log(e.message)})}},{key:"getRecentList",value:function(){var e=this;return new Promise(function(t,n){h.default.getRecentMember().then(function(n){if(0===n.code){var r=n.data.filter(function(e){return!(e.status<0)&&!(!e.email&&!e.id)});e.recentList=[].concat(r),t()}},function(e){n(e)})})}},{key:"getTeamMembers",value:function(){var e=this;return new Promise(function(t,n){h.default.getTeamMembers({roles:["creator","admin","member","pending"]}).then(function(n){e.teamMembers=[].concat(n.map(function(e){return e.isShared=!0,e.email+="（已是企业成员）",e})),t()},function(e){n(e)})})}},{key:"onUserListChange",value:function(e){var t=this,n=this.state,i=n.userList,a=n.newAddUserList,o=n.keyword;i.forEach(function(n){h.default.isSameUser(n,e.user)&&(n.isChecked=!1,"select"===e.type?(n.isChecked=!0,n.isNew&&a.every(function(e){return e.email!==n.email})&&a.unshift(n)):"unSelect"===e.type&&(n.isChecked=!1,o||r.remove(i,function(e){return h.default.isSameUser(n,e)&&e.isNew}),r.remove(t.newAddUserList,function(e){return h.default.isSameUser(n,e)})))}),this.limitUserListCount(i,a),this.setState({userList:[].concat(i),newAddUserList:a},function(){"select"===e.type&&t.state.keyword&&1===i.length&&t.clear()})}},{key:"onSwitcherClick",value:function(){var e=this;if("list"===this.state.type){var t=this.state.userList.filter(function(e){return e.isChecked&&!e.isShared&&e.email}).map(function(e){return e.email}).join(",");this.setState({type:"email",emailContent:t},function(){e.props.asCenter&&e.props.asCenter()})}else{var n=[],r=this.state.emailContent.replace(/[\r|\n|,]/g," ").replace(/\s+/g,","),i=r.split(",").filter(function(e){return b.default.regs.email.test(e)});i.forEach(function(t){var r={name:"邮件邀请",email:t,avatar:"https://assets-cdn.shimo.im/assets/images/invited-f41924e412.png",isChecked:!0,isNew:!0},i=e.getFilterUserList(r.email,"cache"),a=e.getFilterUserList(r.email,"recent");e.getFilterUserList(r.email,"team").length?r=null:i.length?(r=i[0],r.isNew=!0):a.length&&(r=null,a[0].isChecked=!0),r&&(r.isChecked=!0,n.push(r))}),this.recentList.forEach(function(e){e.isChecked&&!e.isShared&&i.every(function(t){return e.email!==t})&&(e.isChecked=!1)}),this.limitUserListCount(this.state.userList,n),this.setState({type:"list",userList:n.concat(this.recentList),newAddUserList:n},function(){e.props.asCenter&&e.props.asCenter()})}}},{key:"getFilterUserList",value:function(e,t){var n=[];return"recent"===t?n=this.recentList:"team"===t?n=this.teamMembers:"cahce"===t&&(n=this.usersSearchCaches),n.filter(function(t){return!(!t.email||!t.email.match(new RegExp(e),"ig"))})}},{key:"search",value:function(e){var t=this,n={};if(e){var r=!1,i=this.getFilterUserList(e,"recent"),a=this.getFilterUserList(e,"team");if(i.length)n.userList=i;else if(a.length)n.userList=[].concat(a);else if(b.default.regs.email.test(e)){var o={name:"",avatar:"https://assets-cdn.shimo.im/assets/images/loading-b67e5a67dc.gif",email:e,isChecked:e===cow.currentUser.email,isNew:!0};n.userList=[o],r=!0}else n.userList=[];this.state.inviteActionVisible&&(n.inviteActionVisible=!1);var l=[].concat(this.state.newAddUserList);this.limitUserListCount(n.userList,l),n.newAddUserList=l,this.setState(n,function(){r&&t.enrichUserInfo(e)})}else this.clear()}},{key:"clear",value:function(e){var t=this.state,n=t.newAddUserList,r=t.inviteActionVisible,i={keyword:""};i.userList=n.concat(this.recentList),r||(i.inviteActionVisible=!0),this.setState(i,function(){"function"==typeof e&&e()})}},{key:"enrichUserInfo",value:function(e){var t=this,n=function(e){var n=t.state.userList,r=!1;(n||[]).forEach(function(t){h.default.isSameUser(e,t)&&(t.name=e.name,t.isShared=!1,t.avatar=e.avatar,r=!0)}),r&&t.setState({userList:[].concat(n)})},r=this.usersSearchCaches.find(function(t){return t.email===e});r?n(r):h.default.searchByEmail(e).then(function(e){n(e),t.usersSearchCaches.push(e)},function(){n({email:e,name:"邮件邀请",avatar:"https://assets-cdn.shimo.im/assets/images/invited-f41924e412.png"})})}},{key:"onSearchInputChange",value:function(e){var t=e.target.value;t!==this.state.keyword&&(this.setState({keyword:t}),this.search(t))}},{key:"onSearchInputKeydown",value:function(e){if(e.keyCode===b.default.keyCodes.ENTER){var t=this.state.userList;1!==t.length||t[0].isChecked||(t[0].isChecked=!0,this.onUserListChange({type:"select",user:t[0]}))}}},{key:"onTextareaChange",value:function(e){var t=e.target.value,n=e.target.value.replace(/[\r|\n|,]/g," ").replace(/\s+/g,","),r=n.split(",").filter(function(e){return b.default.regs.email.test(e)});if(r.length>=this.maxInviteCount){var i=r[19],a=t.indexOf(i)+i.length,o=t.substr(0,a);this.setState({emailContent:o})}else this.setState({emailContent:t})}},{key:"limitUserListCount",value:function(e,t){var n=this.recentList.concat(t);n.filter(function(e){return e.isChecked&&!e.isShared}).length>=this.maxInviteCount?n.concat(e).forEach(function(e){e.isChecked||e.isShared||e.isDisable||(e.isDisable=!0)}):n.concat(e).forEach(function(e){e.isDisable&&(e.isDisable=!1)})}},{key:"startInvite",value:function(){var e=this,t=this.state,n=t.type,i=t.emailContent;if(!t.isSending){var a=[],o=[];if("list"===n)a=this.state.userList.filter(function(e){return e.isChecked&&!e.isShared}).map(function(e){return e.email||e.id});else if("email"===n){var l=i.replace(/[\r|\n|,]/g," ").replace(/\s+/g,",");o=l.split(",").filter(function(e){return e&&!e.match(/[\s|,]/)&&!b.default.regs.email.test(e)}),a=l.split(",").filter(function(e){return b.default.regs.email.test(e)})}a.length?this.setState({isSending:!0,errorList:[]},function(){v.default.inviteMembers(a).then(function(t){t.failedUsers=t.failedUsers||[];var n=t.successedCount,i=(t.failedCount,t.failedUsers);n>0?b.default.alert({title:"成功邀请 "+n+" 人"}):b.default.alert({title:"邀请失败",type:"error"});var a={isSending:!1,emailContent:i.concat(o).join(","),userList:e.state.userList.filter(function(t){if(i.indexOf(t.email)>-1||i.indexOf(t.id)>-1)return!0;var n=r.find(e.recentList,{id:t.id});return n?(n.isShared||(n.isChecked=!1),!0):!(t.isChecked&&!t.isShared)}),newAddUserList:e.state.newAddUserList.filter(function(e){return!(e.isChecked&&!e.isShared)||i.indexOf(e.email)>-1||i.indexOf(e.id)>-1||void 0})};"list"===e.state.type?e.limitUserListCount(a.userList,a.newAddUserList):a.errorList=i,e.setState(a)},function(){b.default.alert({title:"邀请失败",type:"error"}),e.setState({isSending:!1})})}):b.default.alert({title:"请输入正确的邮箱",type:"error",delay:1500})}}},{key:"renderLoader",value:function(){return this.state.isLoading?c.default.createElement("div",{className:"spinner"}):null}},{key:"render",value:function(){var e=this.state,t=e.emailContent,n=e.isSending,r=e.errorList,i=this.state.userList||[],a=i.filter(function(e){return e.isChecked&&!e.isShared}).length,o={height:"33px",minWidth:"110px",lineHeight:"32px"},l=(0,w.default)({"search-clear-icon":!0,hide:!this.state.keyword}),s=(0,w.default)({"invitation-error-info":!0,hide:0===r.length}),u=r.join(",")+" 邀请失败";return"list"===this.state.type?c.default.createElement("div",{className:"invitation-email-panel"},c.default.createElement("div",{className:"search-wrap invitation-input-box"},c.default.createElement("input",{ref:"searchInput",type:"text",autoComplete:"off",value:this.state.keyword,className:"search-input",placeholder:"输入工作邮箱，发送邮件邀请",onKeyDown:this.onSearchInputKeydown,onChange:this.onSearchInputChange}),c.default.createElement("i",{className:"search-input-icon"}),c.default.createElement("i",{className:l,onClick:this.clear})),c.default.createElement("div",{className:"invitation-recent-wrap",style:{height:"335px"}},c.default.createElement(f.default,{classPrefix:"invitation",onChange:this.onUserListChange,selectable:!0,userList:i})),this.state.inviteActionVisible?c.default.createElement("div",{className:"invitation-panel-foot"},c.default.createElement("a",{className:"email-mode-switcher",onClick:this.onSwitcherClick},"批量添加成员"),c.default.createElement("button",{className:"sm-btn sm-btn-primary "+(n?"disable":""),style:o,onClick:this.startInvite},n?"正在发送...":"发送邀请"+(a?" ("+a+")":""))):c.default.createElement("div",{className:"invitation-panel-foot",style:{height:"33px"}}),this.renderLoader()):c.default.createElement("div",{className:"invitation-email-panel"},c.default.createElement("div",{style:{fontSize:"12px",paddingTop:"8px",paddingBottom:"15px",lineHeight:1,color:"#a5a5a5"}},"请输入邮箱，多个邮箱之间用逗号“,”分隔，一次最多邀请 ",this.maxInviteCount," 人"),c.default.createElement("textarea",{className:"invitation-email-list sm-form-control",onChange:this.onTextareaChange,value:t}),c.default.createElement("p",{className:s},u),c.default.createElement("div",{className:"invitation-panel-foot"},c.default.createElement("button",{className:"sm-btn sm-btn-primary "+(n?"disable":""),style:o,onClick:this.startInvite},n?"正在发送...":"发送邀请"),c.default.createElement("button",{className:"sm-btn sm-btn-default",style:o,onClick:this.onSwitcherClick},"取消")))}}]),t}(u.Component);t.default=k,k.propTypes={onChange:u.PropTypes.func,asCenter:u.PropTypes.func},e.exports=t.default}).call(t,n(1))},1166:function(e,t,n){var r=n(0),i=n(1167),a=n(1059);e.exports=r.createClass({displayName:"exports",propTypes:{data:r.PropTypes.array,adapter:r.PropTypes.object,rowDom:r.PropTypes.func,headDom:r.PropTypes.func,onClickRow:r.PropTypes.func,onClickHead:r.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{rowDom:function(e,t){var n=t&&t.title||"";return r.createElement("div",{className:""},n)},headDom:function(e,t){var n=t||"";return r.createElement("div",{className:""},n)},onClickRow:function(e,t,n){alert("click row: "+t.group+", "+t.row+"\ndata: "+JSON.stringify(n))},onClickHead:function(e,t,n){alert("click head:"+t.group+"\ndata: "+JSON.stringify(n))}}},render:function(){var e,t=this.props;return e=t.adapter&&"group"==t.adapter.type?t.data.map(function(e,n){return r.createElement(i,r.__spread({},t,{key:n,groupIndex:n,groupItem:e}))}):t.data.map(function(e,n){return r.createElement(a,r.__spread({},t,{key:n,groupIndex:0,rowIndex:n,rowItem:e}))}),r.createElement("div",{className:"ui-list"},e)}})},1167:function(e,t,n){var r=n(0),i=n(1059),a=n(1168);e.exports=r.createClass({displayName:"exports",propTypes:{},render:function(){var e,t=this.props;return e=this.props.groupItem.items.map(function(e,n){return r.createElement(i,r.__spread({},t,{key:n,groupIndex:t.groupIndex,rowIndex:n,rowItem:e}))}),r.createElement("div",{className:"ui-list-group"},r.createElement(a,r.__spread({},t,{groupIndex:t.groupIndex,headItem:t.groupItem.name})),e)}})},1168:function(e,t,n){var r=n(0);e.exports=r.createClass({displayName:"exports",render:function(){var e={group:this.props.groupIndex};return r.createElement("div",{className:"ui-list-head",onClick:this._onClickHead},this.props.headDom(e,this.props.headItem))},_onClickHead:function(e){var t={group:this.props.groupIndex};this.props.onClickHead(e,t,this.props.headItem)}})},1438:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n(650),l=i(o),s=n(743),u=i(s),c=n(1441),d=r(c),f=function(){return{type:"CLEAR_LIST"}},p=function(e){return{type:"ADD_FILE",file:e}},h=function(e){return{type:"ADD_FILES",files:e}},m=function(e){return{type:"DELETE_FILE",guid:e}},v=function(e,t){return{type:"MOVE_FILE",fromIndex:e,toIndex:t}},y=function(e){return{type:"PREPARE_MOVE",guid:e}},g=function(e,t){return{type:"START_MOVE",fromIndex:e,toIndex:t}},b=function(){return{type:"END_MOVE"}},_=function(e,t,n){return{type:"CANCEL_MOVE",fromIndex:t,toIndex:n,guid:e}},w=function(e,t){return{type:"ROLLBACK_MOVE",originIndex:e,newIndex:t}},k=function(e,t){return{type:"UPDATE_FILE",guid:e,newAttrs:t}},E=function(e){return{type:"CHANGE_GRID_MODE",newMode:e}},C=function(e){return{type:"CHANGE_ORDER_RULE",orderBy:e,orderType:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc"}},T=function(e){return{type:"PREPARE_DRAG_TO_CRUMB",isEnter:e}},O=function(e,t){return{types:["RECENT_PAGINATION_LOAD","RECENT_PAGINATION_SUCCESS","RECENT_PAGINATION_FAIL"],promise:d.default.getRecentList(e,t)}};t.default=a({},l,u,{clearList:f,addFile:p,addFiles:h,deleteFile:m,moveFile:v,prepareMove:y,startMove:g,cancelMove:_,rollbackMove:w,endMove:b,updateFile:k,changeGridMode:E,changeOrderRule:C,prepareDragToCrumb:T,goNextPage:O}),e.exports=t.default},1441:function(e,t,n){(function(r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),o=n(22),l=n(147),s=function(e){var t=e,n=e.children,r={};if(n&&n.length>0){var i=t.guid||"";n.map(function(e){return e.authorized=void 0===e.authorized||e.authorized,e.parent={guid:i},e}).forEach(function(e){r[e.guid]=e})}else void 0===n&&(t.authorized=window.cow.authorized,r[t.guid]=t);return r},u=function(e){return r.remove(e.children,function(e){return!!e.is_delete}),e},c=function(e,t){var n=window.cow.tempCurrentFile,r=window.cow.tempCurrentFile.guid||"";if(!t&&n&&e===r)return Promise.resolve(u(n));var i=window.cow.listType,s=(0,a.genGuid)(),c="";return["recent","favorites"].indexOf(i)>-1?(c="/-/"+i+"/?t="+s,"recent"===i&&(c="/-/"+i+"/?t="+s+"&page_size="+l.recentPagesize+"&page=0")):c="/-/"+e+"?t="+s,void 0===e&&(c="/-/?t="+s),(0,o.ajaxGet)(c).then(function(t){if(0===t.code){var n=t.data.file;return u(n)}throw location.href=e?"/folder/"+e:"/desktop",new Error("ajax error: "+t.code)}).catch(function(t){throw window.loction.href=e?"/folder/"+e:"/desktop",new Error("ajax error")})},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.recentPagesize,n=i.Deferred(),r=(0,a.genGuid)(),o="",s="";void 0!==e&&(o="&page="+e),void 0!==t&&(s="&page_size="+t);var c="/-/recent/?t="+r+o+s;return i.get(c).done(function(e){if(0===e.code){var t=e.data.file;n.resolve(u(t))}else n.reject(e)}).fail(function(e){n.reject(e)}),n.promise()};t.default={processListData:s,getListByGuid:c,getRecentList:d},e.exports=t.default}).call(t,n(1),n(2))},1442:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1441),a=r(i),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{types:["LIST_LOAD","LIST_LOAD_SUCCESS","LIST_LOAD_FAIL"],promise:a.default.getListByGuid(e,t)}},l=function(e,t){return{types:["RECENT_LIST_LOAD","RECENT_LIST_LOAD_SUCCESS","RECENT_LIST_LOAD_FAIL"],promise:a.default.getRecentList(e,t)}};t.default={getList:o,getRecentList:l},e.exports=t.default},1446:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=i(u),d=n(13),f=i(d),p=n(5),h=i(p),m=n(20),v=i(m),y=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={},n.handleOtherClick=n._handleOtherClick.bind(n),n._onMenuItemClick=n._onMenuItemClick.bind(n),n._onInputClick=n._onInputClick.bind(n),n._onInputChange=n._onInputChange.bind(n),n._onInputBlur=n._onInputBlur.bind(n),n._onInputFocus=n._onInputFocus.bind(n),n._onInputKeyPress=n._onInputKeyPress.bind(n),n}return l(t,e),s(t,[{key:"componentWillMount",value:function(){r(window).on("click",this.handleOtherClick),r(".header-item-add-wrap").on("click",this.handleOtherClick)}},{key:"componentWillUnmount",value:function(){r(window).off("click",this.handleOtherClick),r(".header-item-add-wrap").off("click",this.handleOtherClick)}},{key:"hide",value:function(){var e=this.props,t=e.onHide,n=e.hideOperation;"function"==typeof n&&n(),"function"==typeof t&&t()}},{key:"updateName",value:function(){var e=this.props.file;this.setState({name:e.name})}},{key:"_handleOtherClick",value:function(e){var t=e.target,n=this.props,r=n.file,i=n.active,a=!!/icon-settings/.test(e.target.getAttribute("class")),o=!!/list-dropdown-btn/.test(e.target.getAttribute("class"));if(a||o){var l="";if(a)l=t.className;else{var s=e.target.getElementsByClassName("icon-settings");s=s.length>0?s[0]:null,s&&(l=s.className)}var u=l.match(/settings-([0-9a-zA-Z]{16})/);u=u&&u[1]?u[1]:"",u!==r.guid&&i&&!f.default.findDOMNode(this).contains(t)&&this.hide()}else i&&!f.default.findDOMNode(this).contains(t)&&this.hide()}},{key:"_onInputFocus",value:function(e){var t=this.state.name,n=this.props.file,r=this.props.file.type;return void 0===t&&(t=n.name),(1===r&&"新建文件夹"===t||1!==r&&"无标题"===t)&&this.setState({name:""}),e.preventDefault(),!1}},{key:"_onInputBlur",value:function(){if(this.props.active){var e=this.state.name,t=this.props,n=t.handleUpdateFile,r=t.file;e||(e=1===r.type?"新建文件夹":"无标题"),e!==r.name&&"function"==typeof n&&(n(r,{name:e}),cow.currentFile.guid===r.guid&&(cow.currentFile.name=e))}}},{key:"_onInputKeyPress",value:function(e){var t=this.props,n=t.handleUpdateFile,r=t.file,i=this.state.name;e.charCode===h.default.keyCodes.ENTER&&(this.hide(),"function"==typeof n&&(""===i&&(i=1==+r.type?"新建文件夹":"无标题",this.setState({name:i})),n(r,{name:i}),cow.currentFile.guid===r.guid&&(cow.currentFile.name=i)))}},{key:"_onInputClick",value:function(e){window.cow.alphaFeatures.double_click&&e.nativeEvent.stopImmediatePropagation()}},{key:"_onInputChange",value:function(){var e=this.refs.nameInput,t=e.value;this.setState({name:t})}},{key:"_onMenuItemClick",value:function(e){var t=this.props.handleMenuItemClick;if("function"==typeof t){var n=e.currentTarget.className,r="";n.match(/unmark-star/)?r="unmark":n.match(/mark-star/)?r="mark":n.match(/share-ob/)?r="share":n.match(/cancel-share/)?r="unshare":n.match(/create-copy/)?r="copy":n.match(/delete-ob/)?r="delete":n.match(/move-file/)?r="move":n.match(/locate-folder/)&&(r="locate"),r&&t(r)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.active,r=t.file,i=t.listType,a=t.position,o=r.type,l=r.starred,s=r.permissions,u=r.role,d=r.name,f=this.state.name;void 0===f&&(f=r.name);var p=function(t,n){var r=function(){return c.default.createElement("div",{className:"list-menu-item "+t,onClick:e._onMenuItemClick},c.default.createElement("span",{className:"list-menu-item-icon menu-"+t+"-icon little-icon-sprite"}),c.default.createElement("span",null,n))};return"locate-folder"!==t||"favorites"!==i&&"recent"!==i?"unmark-star"===t&&l?r():"mark-star"!==t||l?"share-ob"===t?r():"create-copy"===t&&1!==o&&"list"===i?r():["delete-ob","move-file"].indexOf(t)>-1?["recent","favorites"].indexOf(i)>-1&&!s.manageable?null:r():null:r():r()};if(u){var h=p("delete-ob","删除"),m=null;h&&(m=c.default.createElement("hr",null));var y=(0,v.default)({"file-operations":!0,"list-item-dropdown":!0,"folder-top-right-dropdown":"folder-top-right"===a,active:n});return c.default.createElement("div",{draggable:!1,className:y},c.default.createElement("div",{className:"trangle"},c.default.createElement("span",{className:"list-trangle-item top"}),c.default.createElement("span",{className:"list-trangle-item down"})),c.default.createElement("div",{className:"normal-menu list-item-menu"},c.default.createElement("div",{className:"name-input list-item-name"},c.default.createElement("input",{className:"form-control list-item-input",ref:"nameInput","data-value":f,placeholder:1==+o?"文件名称":"文档标题",defaultValue:d,value:f,onClick:this._onInputClick,onChange:this._onInputChange,onBlur:this._onInputBlur,onFocus:this._onInputFocus,onKeyPress:this._onInputKeyPress})),p("locate-folder","定位到所在文件夹"),p("unmark-star","取消标星"),p("mark-star","标星"),p("share-ob","协作"),p("move-file","移动"),"editable"===cow.permission&&p("create-copy","创建副本"),m,h))}var g=(0,v.default)({dropdown:!0,"file-operations":!0,"list-item-dropdown":!0,"folder-top-right-dropdown":!!a,active:n});return c.default.createElement("div",{draggable:!1,className:g},c.default.createElement("div",{className:"trangle"},c.default.createElement("span",{className:"list-trangle-item top"}),c.default.createElement("span",{className:"list-trangle-item down"})),p("locate-folder","定位到所在文件夹"),p("unmark-star","取消标星"))}}]),t}(u.Component);t.default=y,y.propTypes={active:u.PropTypes.bool,file:u.PropTypes.object,listType:u.PropTypes.string,hideOperation:u.PropTypes.func,handleUpdateFile:u.PropTypes.func,handleMenuItemClick:u.PropTypes.func,onHide:u.PropTypes.func,position:u.PropTypes.string},e.exports=t.default}).call(t,n(2))},1453:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1502),a=r(i);n(1510),t.default=a.default,e.exports=t.default},1487:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(1488),d=r(c),f=n(1490),p=r(f),h=n(1493),m=r(h),v=n(20),y=r(v);n(1495);var g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={listTopHeader:{},listCrumbHeader:{}},n}return o(t,e),l(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.currentFile,n=e.gridMode;1===t.type&&this.adjustListTopHeaderHeight(n)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.currentFile,r=t.gridMode,i=t.listType;1!==n.type&&"list"!==i||n.guid==e.currentFile.guid&&r==e.gridMode||this.adjustListTopHeaderHeight(r)}},{key:"adjustListTopHeaderHeight",value:function(e){var t=document.querySelector(".crumb-list").offsetHeight;if(t<=24)this.setState({listTopHeader:{},listCrumbHeader:{}});else if(t+=45,"tiled"===e){var n={height:t+"px"};this.setState({listTopHeader:n,listCrumbHeader:{}})}else if("table"===e){var r=t+40,i={height:r+"px"},a={height:t+"px"};this.setState({listTopHeader:i,listCrumbHeader:a})}}},{key:"render",value:function(){var e=this.props,t=e.gridMode,n=e.listType,r=e.currentFile,i=e.files,a=e.loaded,o=e.isMoving,l=e.dispatch,s=e.orderRule,c=e.alphaFeatures,f=e.isScrolled,h=e.scrollLeft,v=this.state,g=v.listTopHeader,b=v.listCrumbHeader,_=(0,y.default)({"list-header-wrap":!0,scroll:f}),w={};return h>=0?w.left=164-h+"px":w={},g.height&&(w.height=g.height),u.default.createElement("div",{className:"list-top-header "+t,style:g},u.default.createElement("div",{className:_,style:w},u.default.createElement("div",{className:"list-crumb-header",style:b},u.default.createElement(d.default,{listType:n,gridMode:t,currentFile:r,files:i,loaded:a,enableDrop:o,dispatch:l,alphaFeatures:c}),u.default.createElement(p.default,{listType:n,dispatch:l,gridMode:t,currentFile:r})),u.default.createElement(m.default,{listType:n,gridMode:t,orderRule:s,dispatch:l})))}}]),t}(s.Component);g.propTypes={scrollLeft:s.PropTypes.number,isScrolled:s.PropTypes.bool,listType:s.PropTypes.string,gridMode:s.PropTypes.string,currentFile:s.PropTypes.object,isMoving:s.PropTypes.bool,files:s.PropTypes.array,loaded:s.PropTypes.bool,enableDrop:s.PropTypes.bool,dispatch:s.PropTypes.func,alphaFeatures:s.PropTypes.object,orderRule:s.PropTypes.object},t.default=g,e.exports=t.default},1488:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(5),d=r(c),f=n(72),p=r(f),h=n(1438),m=r(h),v=n(146),y=r(v);n(1489);var g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={willAcceptDropTag:""},n}return o(t,e),l(t,[{key:"shouldComponentUpdate",value:function(e){return e.loaded}},{key:"_onDrop",value:function(e){var t=this.props,n=t.dispatch,r=t.enableDrop,i=t.files;if(r){var a=e.dataTransfer.getData("Text"),o=e.currentTarget.getAttribute("data-guid")||"";"0"===o&&(o="");var l=null;if(i.some(function(e){return e.guid===a&&(l=e,!0)})){var s=l.shortcut_id?"shortcut":"file",u=0===l.type?"文档":1===l.type?"文件夹":"表格";p.default.moveToFolder(a,o,s,"info").then(function(e){var t={title:"移动"+u,description:"",confirmLabel:"确认",abortLabel:"取消",confirmFun:function(){p.default.moveToFolder(a,o,s,"action").then(function(){setTimeout(function(){n(m.default.updateFile(a,{is_delete:2}))},200)})}};if("dialog"===e.data.type){var r=e.data;r.data.removeUserCount>0&&(t.description="移动后所有上级文件夹的共享成员将无权限访问该"+u),r.data.addUserCount>0&&(t.description="移动后所有上级文件夹的共享成员将有权限访问该"+u),t.description&&(0,y.default)(t)}}).fail(function(e){"no_move_privilege"===e.message?o?d.default.alert({title:"暂时只有"+u+"的创建者才能将"+u+"移入共享文件夹",type:"error"}):d.default.alert({title:"暂时只有"+u+"的创建者才能将"+u+"移动到桌面",type:"error"}):e.error?d.default.alert({title:e.error,type:"error"}):d.default.alert({title:"移动文件失败",type:"error"})}),this.setState({willAcceptDropTag:""})}}}},{key:"_onDragEnter",value:function(e){var t=this.props,n=t.enableDrop,r=t.dispatch,i=e.currentTarget.getAttribute("data-guid");n&&(this.setState({willAcceptDropTag:i}),r(m.default.prepareDragToCrumb(!0))),e.preventDefault()}},{key:"_onDragLeave",value:function(){var e=this.props,t=e.enableDrop,n=e.dispatch;t&&(this.setState({willAcceptDropTag:""}),n(m.default.prepareDragToCrumb(!1)))}},{key:"_onDragOver",value:function(e){e.preventDefault()}},{key:"_renderCrumbList",value:function(e){var t=this,n=[],r=this.props.currentFile,i={name:"我的桌面",link:"/desktop"};if(!e)return u.default.createElement("span",{className:"no-crumb"},i.name);e.unshift(i),e.forEach(function(e,r){var i=e.link?e.link:"/folder/"+e.guid,a=e.guid?e.guid:"0",o=d.default.cutName(e.name,32),l=t.state.willAcceptDropTag;n.push(u.default.createElement("a",{key:r,className:"crumb list-crumb-item "+(l===a?"scale":""),href:i,"data-guid":a,onDrop:t._onDrop.bind(t),onDragEnter:t._onDragEnter.bind(t),onDragLeave:t._onDragLeave.bind(t),onDragOver:t._onDragOver.bind(t)},o)),n.push(u.default.createElement("span",{key:1e3+r,className:"hicon icon-breadcrumb"}))});var a=d.default.cutName(r.name);return n.push(u.default.createElement("span",{key:e.length,className:"no-crumb"},a)),n}},{key:"render",value:function(){var e=this.props,t=e.currentFile,n=e.listType,r=e.enableDrop;if("list"===n){var i=t.crumbList?[].concat(t.crumbList):void 0;return u.default.createElement("div",{className:"crumb-list sm-list-crumb "+(r?"ondrag":"")},this._renderCrumbList(i))}return u.default.createElement("div",{className:"crumb-list sm-list-crumb"},u.default.createElement("span",{className:"no-crumb"},"favorites"===n?"标星文件":"recent"===n?"最近使用":""))}}]),t}(s.Component);t.default=g,g.propTypes={dispatch:s.PropTypes.func.isRequired,files:s.PropTypes.array,currentFile:s.PropTypes.object,listType:s.PropTypes.string,gridMode:s.PropTypes.string,enableDrop:s.PropTypes.bool},e.exports=t.default},1489:function(e,t){},1490:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(1491),d=r(c),f=n(726),p=n(1438),h=r(p),m=n(1446),v=r(m),y=n(72),g=r(y),b=n(146),_=r(b),w=n(5),k=r(w),E=n(323),C=r(E),T=n(730),O=n(20),P=r(O),S=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showOperation:!1,shareCount:0},n.handleUpdateFile=n.handleUpdateFile.bind(n),n.handleOperationHide=n.handleOperationHide.bind(n),n.hideOperation=n.hideOperation.bind(n),n.handleMenuItemClick=n.handleMenuItemClick.bind(n),n.showTeamworker=n.showTeamworker.bind(n),n.onSettingsClick=n.onSettingsClick.bind(n),n}return o(t,e),l(t,null,[{key:"PropTypes",get:function(){return{listType:s.PropTypes.string,dispatch:s.PropTypes.func,gridMode:s.PropTypes.string,currentFile:s.PropTypes.object}}}]),l(t,[{key:"componentDidMount",value:function(){var e=this.props.currentFile;this.getFolderCollaborators(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentFile;this.getFolderCollaborators(t)}},{key:"renderFolderShortCut",value:function(){var e=this.state.shareCount,t=(0,P.default)({"list-folder-short-cut":!0,"no-collaborators":e<2});return u.default.createElement("div",{className:t},this.renderFolderCollaborators(),u.default.createElement("span",{className:"list-folder-setting",onClick:this.onSettingsClick}))}},{key:"renderFolderCollaborators",value:function(){var e=this.state.shareCount;return e>1?u.default.createElement("div",{className:"folder-collaborators-container",onClick:this.showTeamworker},u.default.createElement("span",{className:"folder-collaborators-icon"}),u.default.createElement("span",{className:"folder-collaborators-number"},e,"人协作")):u.default.createElement("span",{className:"folder-no-collaborators",onClick:this.showTeamworker},"添加协作者")}},{key:"getFolderCollaborators",value:function(e){var t=this,n=e.type;if(n&&1===n){var r=e.guid;g.default.getFileCollaborators(r).then(function(e){t.setState({shareCount:e.length})})}}},{key:"handleUpdateFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.props.dispatch,i=e.guid,a={};for(var o in t)e[o]!==t[o]&&(a[o]=e[o]);r(h.default.updateFile(i,t)),n?r(h.default.updateFile(i,t)):g.default.updateFile(e,t).then(function(e){r(h.default.updateFile(i,e))}).fail(function(){r(h.default.updateFile(i,a))})}},{key:"handleOperationHide",value:function(){var e=this.props.currentFile;e.isNew&&"function"==typeof handleUpdateFile&&this.handleUpdateFile(e,{isNew:!1},!0)}},{key:"hideOperation",value:function(){this.setState({showOperation:!1})}},{key:"menuItemClick",value:function(e,t){var n=this.props.dispatch;if("mark"===e)g.default.createFavoriteFile(t).then(function(e){n(h.default.updateFile(t.guid,e)),t.starred=!0});else if("unmark"===e)g.default.destroyFavoriteFile(t).then(function(e){n(h.default.updateFile(t.guid,e)),t.starred=!1});else if("delete"===e)this.doDeleteFile(t);else if("move"===e)this.showFileMover(t);else if("share"===e)this.showTeamworker(t);else if("unshare"===e){var r=1===t.type?"文件夹":0===t.type?"文档":"表格";if(t.permissions.manageable){var i={title:"转让管理员权限",description:"管理员退出共享需转让管理员权限",confirmLabel:"转让权限",abortLabel:"取消",confirmFun:function(){new TransferAdmin("#transfer-admin").showTransferAdmin(t)}};(0,_.default)(i)}else{var a={title:"退出共享",description:"确认要退出共享吗？<br />退出共享后你将无权限访问该文件",confirmLabel:"确定",abortLabel:"取消",confirmFun:function(){g.default.quiteShare(t).then(function(){n(h.default.updateFile(t.guid,{is_delete:1})),k.default.alert({title:"已从此"+r+"的共享中退出"})}).fail(function(){k.default.alert({title:"操作失败",type:"error"})})}};(0,_.default)(a)}}}},{key:"handleMenuItemClick",value:function(e){this.setState({showOperation:!1}),this.handleOperationHide();var t=this.props.currentFile;this.menuItemClick(e,t)}},{key:"doDeleteFile",value:function(e){var t=this.props.dispatch,n={title:"确认操作",buttons:[]},r={buttonLabel:"确认删除",customClass:"btn-error",closeAfterClick:!0,onClick:function(){g.default.updateFile(e,{is_delete:1}).then(function(n){t(h.default.updateFile(e.guid,n))}).fail(function(e){C.default.isEnterpriseStandard(cow.currentUser)||C.default.isEnterpriseDingding(cow.currentUser)?k.default.alert({title:e.responseText||"删除失败",type:"error"}):k.default.alert({title:"删除失败",type:"error"})})}},i={buttonLabel:"退出共享",customClass:"btn-ok",closeAfterClick:!0,onClick:function(){g.default.quiteShare(e).then(function(){t(h.default.updateFile(e.guid,{is_delete:1})),k.default.alert({title:"已从此"+e.name+"的共享中退出"})}).fail(function(){k.default.alert({title:"操作失败",type:"error"})})}},a={buttonLabel:"取消",customClass:"",closeAfterClick:!0},o={buttonLabel:"确认",customClass:"btn-ok",closeAfterClick:!0},l=1===e.type?"文件夹":0===e.type?"文档":"表格",s=e.permissions,u=s.manageable,c=s.exitable;u&&c?(n.buttons=[r,i,a],n.description="你可以删除"+l+"<br />也可以退出共享，但不删除"+l):u?(n.buttons=[r,a],n.description="确认删除"+l+"吗？<br />删除后，所有协作者都无法访问此"+l):c?(n.buttons=[i,a],n.description="你不是"+l+"的创建者<br />继续此操作会退出"+l+"共享<br />但不会删除"+l):(n.title="没有权限",n.buttons=[o],n.description="你没有权限删除或退出此"+l),(0,_.default)(n)}},{key:"showFileMover",value:function(e){var t=this;(0,T.showFileMover)({sourceFile:e,onSuccess:function(){t._updateFile(e,{isDelete:1,is_delete:1},!0)}})}},{key:"showTeamworker",value:function(){var e=this.props,t=e.dispatch,n=e.currentFile;t(h.default.pushModal(f.SharedUsersDialog,{currentFile:n}))}},{key:"onSettingsClick",value:function(e){e.stopPropagation();var t=this.state.showOperation;t||this.refs.fileMenu.updateName(),this.setState({showOperation:!t})}},{key:"render",value:function(){var e=this.props,t=e.listType,n=e.dispatch,r=e.gridMode,i=e.currentFile,a=this.state.showOperation,o="list"===t&&i.type;return u.default.createElement("div",{className:"list-top-right-wrap"},o&&this.renderFolderShortCut(),u.default.createElement(d.default,{listType:t,dispatch:n,gridMode:r}),u.default.createElement(v.default,{ref:"fileMenu",listType:t,handleUpdateFile:this.handleUpdateFile,onHide:this.handleOperationHide,hideOperation:this.hideOperation,handleMenuItemClick:this.handleMenuItemClick,file:i,active:a,position:"folder-top-right"}))}}]),t}(s.Component);t.default=S,e.exports=t.default},1491:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=i(u),d=n(1438),f=i(d),p=n(20),h=i(p),m=n(581);n(1492);var v=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this.props.gridMode;window.location.href.match(/from=tutorial/)&&("tiled"===e&&this._switchMode(),r("/desktop"))}},{key:"_switchMode",value:function(){var e=this.props,t=e.dispatch,n=e.gridMode,r="table"===n?"tiled":"table";"table"===r&&(0,m.track)("desktop","change_list_mode",r),t(f.default.changeGridMode(r))}},{key:"render",value:function(){var e=this.props.gridMode,t="table"===e?"平铺":"列表",n=(0,h.default)({"list-mode-icon":!0,"mode-table-icon":"tiled"===e,"mode-tiled-icon":"table"===e});return c.default.createElement("a",{className:"sm-mode-switcher",href:"javascript:void(0);",onClick:this._switchMode.bind(this)},c.default.createElement("i",{className:n}),c.default.createElement("span",{className:"list-mode-name"},t))}}]),t}(u.Component);t.default=v,v.propTypes={dispatch:u.PropTypes.func,listType:u.PropTypes.string,gridMode:u.PropTypes.string},e.exports=t.default}).call(t,n(23))},1492:function(e,t){},1493:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),d=n(20),f=r(d),p=n(1438),h=r(p);n(1494);var m=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"_reOrder",value:function(e){var t=this.props,n=t.dispatch,r=t.orderRule;if("recent"!==t.listType){var i="asc";e===r.orderBy?i="asc"===r.orderType?"desc":"asc":"name"===e?i="asc":"creator"===e?i="asc":"updated_at"===e&&(i="desc"),n(h.default.changeOrderRule(e,i))}}},{key:"render",value:function(){var e=this.props,t=e.gridMode,n=e.orderRule,r=e.listType,a=n.orderBy,o=n.orderType;if("table"===t){var l=function(e){var t,n="update"===e?"updated_at":e;return(0,f.default)((t={"list-table-cell":!0,"table-header":!0},i(t,"file-"+e+"-cell",!0),i(t,"active",a===n),i(t,"is-recent","recent"===r),t))},s=function(e){return a===e&&"recent"!==r?c.default.createElement("i",{className:"file-sprite order-type-icon "+o}):null};return c.default.createElement("div",{key:0,className:"sm-list-header"},c.default.createElement("span",{className:l("name"),onClick:this._reOrder.bind(this,"name")},c.default.createElement("span",{className:"table-header-text"},"文件名"),s("name")),c.default.createElement("span",{className:l("creator"),onClick:this._reOrder.bind(this,"creator")},c.default.createElement("span",{className:"table-header-text"},"创建者"),s("creator")),c.default.createElement("span",{className:l("update"),onClick:this._reOrder.bind(this,"updated_at")},c.default.createElement("span",{className:"table-header-text"},("recent"===r?"打开 / 编辑":"更新")+"时间"),s("updated_at")))}return null}}]),t}(u.Component);m.propTypes={listType:u.PropTypes.string,gridMode:u.PropTypes.string,orderRule:u.PropTypes.object,dispatch:u.PropTypes.func},t.default=m,e.exports=t.default},1494:function(e,t){},1495:function(e,t){},1496:function(e,t,n){(function(r,i){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),d=a(c),f=n(1497),p=a(f),h=n(1498),m=a(h),v=n(1438),y=a(v),g=n(5),b=a(g),_=n(72),w=a(_),k=n(146),E=a(k),C=n(1499),T=a(C),O=n(1140),P=a(O),S=n(552),D=a(S),F=n(323),M=a(F),I=n(194),L=a(I),x=n(730),N=n(22),j=n(1453),A=a(j);n(1511);var R=n(726),U=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={draggingFileGuid:"",draggingFileType:0,originFromIndex:-1,dropped:!1,shareList:[],showFirstInvitation:!1,teamworkerOpen:!1,selectedFileGUID:""},n.onInviteMemberClose=n.onInviteMemberClose.bind(n),n._cancelSelected=n._cancelSelected.bind(n),n._handleItemDragStart=n._handleItemDragStart.bind(n),n._handleItemDragEnter=n._handleItemDragEnter.bind(n),n._handleItemDragEnd=n._handleItemDragEnd.bind(n),n._handleItemDrop=n._handleItemDrop.bind(n),n._handleTableItemDrop=n._handleTableItemDrop.bind(n),n._handleFolderItemDrop=n._handleFolderItemDrop.bind(n),n._updateFile=n._updateFile.bind(n),n._handleMenuItemClick=n._handleMenuItemClick.bind(n),n._handleSingleClick=n._handleSingleClick.bind(n),n._renderFirstInvation=n._renderFirstInvation.bind(n),n}return s(t,e),u(t,[{key:"componentDidMount",value:function(){M.default.isEnterpriseStandard(cow.currentUser)&&"creator"===cow.currentUser.teamRole&&this._prepareForShowInvitation();var e=location.search.slice(1).match(/^fileid=(\d+)&guid=([a-z,A-Z,0-9]{16})$/i)||[];if(e[1]&&e[2]){var t=this.props.dispatch,n="/-/"+e[2];(0,N.ajaxGet)(n).then(function(n){0!==n.code||n.data.file.starred||w.default.starFile(e[1]).then(function(){r("/favorites"),t(y.default.addFile(n.data.file))},function(e){b.default.alert({title:e.message,type:"error"})})}).catch(function(){throw new Error("ajax error")})}window.cow.alphaFeatures.double_click&&document.addEventListener("click",this._cancelSelected)}},{key:"shouldComponentUpdate",value:function(e){var t=e.loaded,n=this.props.loaded,r=this.props.listType,i=e.listType;return t!==n&&r===i&&"recent"===i||t}},{key:"componentDidUpdate",value:function(){this._locateFolder()}},{key:"componentWillUnmount",value:function(){window.cow.alphaFeatures.double_click&&document.removeEventListener("click",this._cancelSelected)}},{key:"_cancelSelected",value:function(){this.setState({selectedFileGUID:""})}},{key:"_getListItems",value:function(e){var t=this,n=[],r=this.state,i=r.draggingFileGuid,a=r.isRollback,o=r.rollbackFileGuid,l=r.selectedFileGUID,s=this.props,u=s.isMoving,c=s.listType,f=s.gridMode,h=s.isDragToCrumb,v=s.currentFile,y=s.loaded,g=s.dispatch;return"list"===c?"tiled"===f?e.forEach(function(e,r){var a=e.guid===i;n.push(d.default.createElement(p.default,{key:r+1,index:r,file:e,draggable:!0,isDragging:a,isMoving:u,listType:c,selected:l===e.guid,showOperation:l===e.guid,handleDragStart:t._handleItemDragStart,handleDragEnter:t._handleItemDragEnter,handleDragEnd:t._handleItemDragEnd,handleDrop:t._handleItemDrop,handleFolderDrop:t._handleFolderItemDrop,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}):"table"===f&&e.forEach(function(e,r){n.push(d.default.createElement(m.default,{key:r+1,file:e,draggable:!0,listType:c,isMoving:u,isDragToCrumb:h,isRollback:a&&e.guid===o,isDragging:e.guid===i,selected:l===e.guid,showOperation:l===e.guid,handleDragStart:t._handleItemDragStart,handleDragEnter:t._handleItemDragEnter,handleDragEnd:t._handleItemDragEnd,handleDrop:t._handleTableItemDrop,handleFolderDrop:t._handleFolderItemDrop,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}):"favorites"===c?"tiled"===f?e.forEach(function(e,r){n.push(d.default.createElement(p.default,{key:r+1,index:r,listType:c,file:e,draggable:!1,isDragging:!1,selected:l===e.guid,showOperation:l===e.guid,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}):"table"===f&&e.forEach(function(e,r){n.push(d.default.createElement(m.default,{key:r+1,file:e,listType:c,draggable:!1,isDragging:!1,selected:l===e.guid,showOperation:l===e.guid,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}):"recent"===c&&e.forEach(function(e,r){var i=[];"tiled"===f?e.files.forEach(function(e,n){i.push(d.default.createElement(p.default,{key:e.guid,index:n,file:e,listType:c,draggable:!1,isDragging:!1,selected:l===e.guid,showOperation:l===e.guid,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}):"table"===f&&e.files.forEach(function(e){i.push(d.default.createElement(m.default,{key:e.guid,file:e,listType:c,draggable:!1,isDragging:!1,selected:l===e.guid,showOperation:l===e.guid,handleUpdateFile:t._updateFile,handleMenuItemClick:t._handleMenuItemClick,handleSingleClick:t._handleSingleClick}))}),"tiled"===f?i.length>0&&n.push(d.default.createElement("li",{key:r+1,className:"recent-wrapper"},d.default.createElement("div",{className:"recent-label"},d.default.createElement("span",{className:"recent-text"},e&&e.timeLabel)),d.default.createElement("ul",{className:"recent-list"},i))):"table"===f&&i.length>0&&n.push(d.default.createElement("li",{key:r+1,className:"recent-wrapper"},d.default.createElement("div",{className:"recent-table-label"},d.default.createElement("span",{className:"recent-text"},e&&e.timeLabel)),d.default.createElement("ul",{className:"recent-list"},i)))}),0===n.length?d.default.createElement("div",{className:"list-empty",draggable:!1},d.default.createElement("div",{className:"list-empty-icon"}),d.default.createElement("div",{className:"list-empty-text"},"没有文件"),"list"===c&&d.default.createElement(A.default,{currentFile:v,listType:c,loaded:y,dispatch:g,dropdownAtCenter:!0})):n}},{key:"_handleItemDragStart",value:function(e,t,n){var r=this.props.dispatch;this.setState({draggingFileGuid:t,draggingFileType:n,originFromIndex:this._getFileIndexByGuid(t)}),r(y.default.prepareMove(t))}},{key:"_handleItemDragEnter",value:function(e,t){var n=this.props.dispatch,r=this.state.draggingFileGuid;if(t!==r){var i=this._getFileIndexByGuid(r),a=this._getFileIndexByGuid(t);i>=0&&a>=0&&n(y.default.moveFile(i,a))}}},{key:"_handleTableItemDrop",value:function(){var e=this.props.dispatch;this.setState({dropped:!0}),e(y.default.endMove())}},{key:"_handleItemDrop",value:function(e,t){var n=this.props,r=n.files,i=n.dispatch,a=this.state,o=a.draggingFileGuid,l=a.originFromIndex;if(t.guid===o){this.setState({dropped:!0});var s=this._getFileIndexByGuid(t.guid);if(s!==l){var u=t.guid,c=s<r.length-1?r[s+1].guid:null;w.default.resortList(u,c).then(function(){i(y.default.endMove())}).fail(function(){i(y.default.rollbackMove(l,s))})}else i(y.default.endMove())}}},{key:"_handleFolderItemDrop",value:function(e,t){var n=this.props.dispatch,r=this.state,i=r.draggingFileGuid,a=r.draggingFileType,o={"-1":"表格","-2":"文档","-3":"表格",0:"文档",1:"文件夹"},l=o[a],s=t.shortcut_id?"shortcut":"file",u=b.default.cutName(t.name,30);if(t.guid!==i){var c={title:"移动"+l,description:"",confirmLabel:"确认",abortLabel:"取消",confirmFun:function(){w.default.moveToFolder(i,t.guid,s,"action").then(function(){n(y.default.updateFile(i,{is_delete:2}))})}};w.default.moveToFolder(i,t.guid,s,"info").then(function(e){if("dialog"===e.data.type){var t=e.data;t.data.removeUserCount>0&&(c.description="移动后，"+l+"将与文件夹「"+u+"」的所有协作者共享"),t.data.addUserCount>0&&(c.description="移动后，"+l+"将与文件夹「"+u+"」的所有协作者共享"),c.description&&(0,E.default)(c)}}).fail(function(e){"no_move_privilege"===e.message?b.default.alert({title:"暂时只有"+l+"的创建者才能将"+l+"移入共享文件夹",type:"error"}):e.error?b.default.alert({title:e.error,type:"error"}):b.default.alert({title:"移动文件失败",type:"error"})})}}},{key:"_handleItemDragEnd",value:function(){var e=this.props,t=e.dispatch,n=e.isDragToCrumb,r=this.state.dropped,i={draggingFileGuid:"",draggingFileType:0,dropped:!1,isRollback:!1};if(!r){var a=this.state,o=a.originFromIndex,l=a.draggingFileGuid,s=this._getFileIndexByGuid(l);i.isRollback=!0,i.rollbackFileGuid=l,t(y.default.rollbackMove(o,s))}this.setState(i),n&&t(y.default.prepareDragToCrumb(!1))}},{key:"_handleMenuItemClick",value:function(e,t){var n=this.props.dispatch;if("mark"===e)w.default.createFavoriteFile(t).then(function(e){n(y.default.updateFile(t.guid,e))});else if("unmark"===e)w.default.destroyFavoriteFile(t).then(function(e){n(y.default.updateFile(t.guid,e))});else if("delete"===e)this._doDeleteFile(t);else if("move"===e)this._showFileMover(t);else if("copy"===e){var i=cow.currentUser,a=i.accountType,o=i.teamRole;if("enterprise_expired"===a)return void("creator"===o||"admin"===o?L.default.show({buttons:[{customClass:"btn btn-ok",buttonLabel:"知道了",closeAfterClick:!0}],headText:"试用到期提醒",bodyText:["<div>石墨文档企业版已到期。目前无法新建／导入文档、添加企业成员，但已有文档仍可以正常编辑与共享。</div><br>","<div>您可以购买或续费企业版服务，也可以删除企业退回到个人版（不会影响任何文档和共享关系）。</div><br>",'<div>致电 400-006-0506 获取购买与折扣信息，或前往 <a href="/enterprise/billing" target="_blank" style="color: #4A90E2; text-decoration: underline;">企业管理</a> 页面。</div>']}):L.default.show({buttons:[{customClass:"btn btn-ok",buttonLabel:"知道了",closeAfterClick:!0}],headText:"试用到期提醒",bodyText:["<div>石墨文档企业版已到期。目前无法新建／导入文档、添加企业成员，但已有文档仍可以正常编辑与共享。</div><br>","<div>请尽快提醒管理员购买或续费企业版服务，或者删除企业退回到个人版（不会影响任何文档和共享关系）。</div><br>","<div>致电 400-006-0506 获取购买与折扣信息。</div>"]}));w.default.createCopyFile(t.guid).then(function(e){e.authorized=!0,e.permissions={readable:!0,editable:!0,commentable:!0,manageable:!0,exitable:!1,collaboratorManageable:!0,outsiderAddable:!1,childFileCreatable:!0,shareModeManageable:!0},n(y.default.addFile(e)),n(y.default.updateFile(e.guid,{permissions:e.permissions,role:"owner"}))})}else if("locate"===e)t.authorized?w.default.getAncestors(t.guid).then(function(e){if(e.length>0){var n=e.pop();window.cow.locateFileGuid=t.guid,r(n.link)}}):b.default.alert({title:"只读或可写文件无法定位所在文件夹",type:"error"});else if("share"===e)this._showTeamworker(t);else if("unshare"===e){var l=1===t.type?"文件夹":0===t.type?"文档":"表格";if(t.permissions.manageable){var s={title:"转让管理员权限",description:"管理员退出共享需转让管理员权限",confirmLabel:"转让权限",abortLabel:"取消",confirmFun:function(){new T.default("#transfer-admin").showTransferAdmin(t)}};(0,E.default)(s)}else{var u={title:"退出共享",description:"确认要退出共享吗？<br />退出共享后你将无权限访问该文件",confirmLabel:"确定",abortLabel:"取消",confirmFun:function(){w.default.quiteShare(t).then(function(){n(y.default.updateFile(t.guid,{is_delete:1})),b.default.alert({title:"已从此"+l+"的共享中退出"})}).fail(function(){b.default.alert({title:"操作失败",type:"error"})})}};(0,E.default)(u)}}}},{key:"_handleSingleClick",value:function(e){this.setState({selectedFileGUID:e.guid})}},{key:"_doDeleteFile",value:function(e){var t=this.props.dispatch,n={title:"确认操作",buttons:[]},r={buttonLabel:"确认删除",customClass:"btn-error",closeAfterClick:!0,onClick:function(){w.default.updateFile(e,{is_delete:1}).then(function(n){t(y.default.updateFile(e.guid,n))}).fail(function(e){M.default.isEnterpriseStandard(cow.currentUser)||M.default.isEnterpriseDingding(cow.currentUser)?b.default.alert({title:e.responseText||"删除失败",type:"error"}):b.default.alert({title:"删除失败",type:"error"})})}},i={buttonLabel:"退出共享",customClass:"btn-ok",closeAfterClick:!0,onClick:function(){w.default.quiteShare(e).then(function(){t(y.default.updateFile(e.guid,{is_delete:1})),b.default.alert({title:"已从此"+e.name+"的共享中退出"})}).fail(function(){b.default.alert({title:"操作失败",type:"error"})})}},a={buttonLabel:"取消",customClass:"",closeAfterClick:!0},o={buttonLabel:"确认",customClass:"btn-ok",closeAfterClick:!0},l=1===e.type?"文件夹":0===e.type?"文档":"表格",s=e.permissions,u=s.manageable,c=s.exitable;u&&c?(n.buttons=[r,i,a],n.description="你可以删除"+l+"<br />也可以退出共享，但不删除"+l):u?(n.buttons=[r,a],n.description="确认删除"+l+"吗？<br />删除后，所有协作者都无法访问此"+l):c?(n.buttons=[i,a],n.description="你不是"+l+"的创建者<br />继续此操作会退出"+l+"共享<br />但不会删除"+l):(n.title="没有权限",n.buttons=[o],n.description="你没有权限删除或退出此"+l),(0,E.default)(n)}},{key:"_showFileMover",value:function(e){var t=this;(0,x.showFileMover)({sourceFile:e,onSuccess:function(){t._updateFile(e,{isDelete:1,is_delete:1},!0)}})}},{key:"_getFileIndexByGuid",value:function(e){var t=this.props.files,n=-1;return t.some(function(t,r){return t.guid===e&&(n=r,!0)}),n}},{key:"_updateFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.props.dispatch,i=e.guid,a={};for(var o in t)e[o]!==t[o]&&(a[o]=e[o]);r(y.default.updateFile(i,t)),n?r(y.default.updateFile(i,t)):w.default.updateFile(e,t).then(function(e){r(y.default.updateFile(i,e))}).fail(function(){r(y.default.updateFile(i,a))})}},{key:"_locateFolder",value:function(){var e=cow.locateFileGuid,t=this.props,n=t.listType,r=t.gridMode;if(e&&"list"===n){var a=i(".list-container"),o=[];if("tiled"===r?o=a.find('div[data-guid="'+e+'"]'):"table"===r&&(o=a.find('li[data-guid="'+e+'"]')),o.length>0){a.scrollTop(0);var l=o.offset().top,s=a.height(),u=o.height(),c=l+u-50-s/2;c>0&&a.animate({scrollTop:c},"500")}cow.locateFileGuid=""}}},{key:"_showTeamworker",value:function(e){this.props.dispatch(y.default.pushModal(R.SharedUsersDialog,{file:e}))}},{key:"_prepareForShowInvitation",value:function(){var e=this;D.default.needToGuide()&&D.default.checkIsReady().then(function(){cow.guideStatus.team_first_invitation||(e.setState({showFirstInvitation:!0}),D.default.removeTipAjax("team_first_invitation"),r("/desktop"))})}},{key:"onInviteMemberClose",value:function(){this.setState({showFirstInvitation:!1})}},{key:"_renderFirstInvation",value:function(){var e=this.state.showFirstInvitation;return e?d.default.createElement(P.default,{open:e,onClose:this.onInviteMemberClose,title:"添加企业成员，高效协作"}):null}},{key:"renderLoadingMore",value:function(){var e=this.props,t=e.pagination,n=e.loading,r=e.listType;return t>-1&&n&&"recent"===r?d.default.createElement("div",{style:{position:"absolute",height:"50px",width:"100%",left:"0",bottom:"30px"}},d.default.createElement("div",{className:"spinner"})):null}},{key:"render",value:function(){var e=this.props,t=e.files,n=e.isMoving,r=e.gridMode,i=cow.currentFile.guid||0,a="number"==typeof cow.currentFile.id?cow.currentFile:0,o="table"===r?"list-grid-table":"";return d.default.createElement("div",{className:"list-outer-container "+o},this._renderFirstInvation(),d.default.createElement("ul",{className:"ob-ul list-inner-container "+o+"  "+(n?"ondrag":""),"data-guid":i,"data-id":a},this._getListItems(t)),this.renderLoadingMore())}}]),t}(c.Component);U.propTypes={files:c.PropTypes.array,loaded:c.PropTypes.bool,loading:c.PropTypes.bool,isMoving:c.PropTypes.bool,dispatch:c.PropTypes.func,listType:c.PropTypes.string,gridMode:c.PropTypes.string,isDragToCrumb:c.PropTypes.bool,currentFile:c.PropTypes.object,pagination:c.PropTypes.number},t.default=U,e.exports=t.default}).call(t,n(23),n(2))},1497:function(e,t,n){(function(r,i){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),d=a(c),f=n(5),p=a(f),h=n(1446),m=a(h),v=n(20),y=a(v),g=p.default.isDingtalkPc(),b=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=n.props.file,i=r.type,a={hover:"",showOperation:n.props.showOperation||!1,toggleClick:!0};return 1===i&&(a.willAcceptDrag=!1),n._timerId=-1,n.state=a,n._onFolderDragEnter=n._onFolderDragEnter.bind(n),n._onFolderDragLeave=n._onFolderDragLeave.bind(n),n._onFolderDrop=n._onFolderDrop.bind(n),n._onSettingsClick=n._onSettingsClick.bind(n),n._onMouseEnter=n._onMouseEnter.bind(n),n._onMouseLeave=n._onMouseLeave.bind(n),n._onDragEnter=n._onDragEnter.bind(n),n._onDragLeave=n._onDragLeave.bind(n),n._onDragOver=n._onDragOver.bind(n),n._onDragStart=n._onDragStart.bind(n),n._onDrop=n._onDrop.bind(n),n._onDragEnd=n._onDragEnd.bind(n),n._onItemClick=n._onItemClick.bind(n),n._onItemDoubleClick=n._onItemDoubleClick.bind(n),n._handleOperationHide=n._handleOperationHide.bind(n),n._hideOperation=n._hideOperation.bind(n),n._handleMenuItemClick=n._handleMenuItemClick.bind(n),n}return s(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){!e.showOperation&&this.state.showOperation&&this.setState({showOperation:!1})}},{key:"_hideOperation",value:function(){this.setState({hover:"",showOperation:!1})}},{key:"_getFileType",value:function(e){var t=+e.type;return 0===t||-2===t?"doc":1===t?"folder":"spreadsheet"}},{key:"_onMouseEnter",value:function(){this.setState({hover:"hover"})}},{key:"_onMouseLeave",value:function(){var e=this.state.showOperation;this.setState({hover:e?"hover":""})}},{key:"_openFile",value:function(e,t){if(t.preventDefault(),!t.target.className.match(/(settings-[0-9a-zA-Z]{16}|list-dropdown-btn)/))if(t.ctrlKey||t.metaKey)p.default.openFile(e);else{var n=+e.type;1===n?r("/folder/"+e.guid):0===n?window.cow.alphaFeatures.double_click&&!g?window.open("/doc/"+e.guid):r("/doc/"+e.guid):-1===n?window.cow.alphaFeatures.double_click&&!g?window.open("/spreadsheet/"+e.guid):r("/spreadsheet/"+e.guid):-3===n?window.cow.alphaFeatures.double_click&&!g?window.open("/sheet/"+e.guid):r("/sheet/"+e.guid):-2===n&&(window.cow.alphaFeatures.double_click&&!g?window.open("/newdoc/"+e.guid):r("/newdoc/"+e.guid))}}},{key:"_onItemClick",value:function(e){var t=this;return function(n){n.preventDefault(),t.state.toggleClick&&(window.cow.alphaFeatures.double_click?(n.nativeEvent.stopImmediatePropagation(),n.ctrlKey||n.metaKey?t._openFile(e,n):"function"==typeof t.props.handleSingleClick&&t.props.handleSingleClick(e)):t._openFile(e,n)),t.setState({toggleClick:!1}),setTimeout(function(){t.state.toggleClick||t.setState({toggleClick:!0})},1e3)}}},{key:"_onItemDoubleClick",value:function(e){var t=this;return function(n){window.cow.alphaFeatures.double_click?t._openFile(e,n):n.preventDefault()}}},{key:"_onDragStart",value:function(e){var t=this;if(this.state.showOperation)return this._stopEvent(e);var n=this.props,r=n.file,i=n.handleDragStart;return e.dataTransfer.setData("Text",r.guid),e.dataTransfer.dropEffect="move",this.setState({hover:""},function(){setTimeout(function(){"function"==typeof i&&t.props.handleDragStart(e,r.guid,r.type)},10)}),!0}},{key:"_onDragEnd",value:function(e){var t=this.props,n=t.file,r=t.handleDragEnd;1===n.type&&this.setState({willAcceptDrag:!1}),"function"==typeof r&&r(e)}},{key:"_onDragEnter",value:function(e){var t=this.props,n=t.isMoving,r=t.file,i=t.handleDragEnter;if(!n)return this._stopEvent(e);var a=100;return 1===r.type&&(a=300),"function"==typeof i&&(this._timerId&&clearTimeout(this._timerId),this._timerId=setTimeout(function(){i(e,r.guid)},a)),e.preventDefault()}},{key:"_onDragLeave",value:function(e){var t=this.props,n=t.file;if(t.isMoving||this._stopEvent(e),1===n.type){var r=i(e.target).offset(),a=e.clientX-r.left,o=e.clientY-r.top;(a<0||a>124||o<0||o>128)&&this._timerId&&(clearTimeout(this._timerId),this._timerId=-1)}}},{key:"_onDragOver",value:function(e){return e.dataTransfer.dropEffect="move",this._stopEvent(e)}},{key:"_onDrop",value:function(e){var t=this.props,n=t.file,r=t.handleDrop;return"function"==typeof r&&r(e,n),this._stopEvent(e)}},{key:"_onFolderDragEnter",value:function(e){var t=this.props,n=t.file;return t.isMoving?(1===n.type&&this._timerId&&(clearTimeout(this._timerId),this.setState({willAcceptDrag:!0})),this._stopEvent(e)):this._stopEvent(e)}},{key:"_onFolderDragLeave",value:function(e){var t=this.props,n=t.file;return t.isMoving?(1===n.type&&this.setState({willAcceptDrag:!1}),this._stopEvent(e)):this._stopEvent(e)}},{key:"_onFolderDrop",value:function(e){var t=this.props,n=t.file,r=t.handleFolderDrop;return t.isMoving?(1===n.type&&("function"==typeof r&&r(e,n),this.setState({willAcceptDrag:!1,hover:"hover"})),this._stopEvent(e)):this._stopEvent(e)}},{key:"_stopEvent",value:function(e){return e.preventDefault(),e.stopPropagation(),!1}},{key:"_onSettingsClick",value:function(e){e.nativeEvent.stopImmediatePropagation();var t=this.state.showOperation,n=this.props,r=n.clearOperation,i=n.file;"function"==typeof r&&r(i.guid),t||this.refs.fileMenu.updateName(),this.setState({showOperation:!t})}},{key:"_handleMenuItemClick",value:function(e){this.setState({showOperation:!1,hover:""}),this._handleOperationHide();var t=this.props,n=t.file,r=t.handleMenuItemClick;"function"==typeof r&&r(e,n)}},{key:"_handleOperationHide",value:function(){var e=this.props,t=e.file,n=e.handleUpdateFile;t.isNew&&"function"==typeof n&&n(t,{isNew:!1},!0)}},{key:"render",value:function(){var e=this,t=this.props,n=t.index,r=t.file,i=t.isDragging,a=t.draggable,o=t.listType,l=t.handleUpdateFile,s=this.state,u=s.hover,c=s.willAcceptDrag,f=r.name,h=r.guid,v=r.id,g=r.shareCount,b=r.parentId,_=r.starred,w=this._getFileType(r),k=this.state.showOperation,E=p.default.cutName(f,32),C=E===f?"":f,T=r.guid===window.cow.locateFileGuid?"hover":u,O=this.props.selected?"selected":"",P=function(){if(i)return d.default.createElement("div",{className:"list-item-content hover"});var t="";0===b&&g>0?t=g+1:b>0&&g>0&&(t="+"+g);var n=function(){return t?d.default.createElement("span",{className:"list-shared-tag file-folder-sprite"}):null},r=function(){return _?d.default.createElement("span",{className:"list-marked-tag file-folder-sprite"}):null};return d.default.createElement("div",{className:w+"-content list-item-content "+(window.cow.alphaFeatures.double_click?"":T)+" "+O},d.default.createElement("div",{className:w+"-style",onDragEnter:e._onFolderDragEnter,onDragLeave:e._onFolderDragLeave,onDrop:e._onFolderDrop,draggable:!1},d.default.createElement("span",{className:"share-count list-share-count","data-share-count":g},t),n(),r()),d.default.createElement("div",{className:"list-item-title info"},E),d.default.createElement("div",{className:"dropdown-btn list-dropdown-btn",onClick:e._onSettingsClick},d.default.createElement("span",{className:"icon-settings settings-"+h})))},S=(0,y.default)({"ob-li":!0,"list-item":!0,scale:c,"first-line":n<7});return d.default.createElement("li",{className:S,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,draggable:a,onDragEnter:this._onDragEnter,onDragLeave:this._onDragLeave,onDragOver:this._onDragOver,onDragStart:this._onDragStart,onDrop:this._onDrop,onDragEnd:this._onDragEnd},d.default.createElement("div",{className:"list-thumbnail thumbnail "+("folder"===w?"folder":""),"data-id":v,"data-guid":h},d.default.createElement("a",{"data-href":"/"+h,target:h,title:C,style:{cursor:window.cow.alphaFeatures.double_click?"default":"pointer"},href:"/"+w+"/"+h,onClick:this._onItemClick(r),onDoubleClick:this._onItemDoubleClick(r)},P()),d.default.createElement(m.default,{ref:"fileMenu",listType:o,handleUpdateFile:l,onHide:this._handleOperationHide,hideOperation:this._hideOperation,handleMenuItemClick:this._handleMenuItemClick,file:r,active:k})))}}]),t}(c.Component);t.default=b,b.propTypes={index:c.PropTypes.number,file:c.PropTypes.object,isDragging:c.PropTypes.bool,draggable:c.PropTypes.bool,listType:c.PropTypes.string,isMoving:c.PropTypes.bool,selected:c.PropTypes.bool,handleUpdateFile:c.PropTypes.func,handleMenuItemClick:c.PropTypes.func,handleDragStart:c.PropTypes.func,handleDragEnd:c.PropTypes.func,handleDragEnter:c.PropTypes.func,handleDrop:c.PropTypes.func,handleFolderDrop:c.PropTypes.func,handleSingleClick:c.PropTypes.func,clearOperation:c.PropTypes.func,showOperation:c.PropTypes.bool},e.exports=t.default}).call(t,n(23),n(2))},1498:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),d=i(c),f=n(20),p=i(f),h=n(5),m=i(h),v=n(1446),y=i(v),g=n(191),b=n(270),_=m.default.isDingtalkPc(),w=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r={hover:"",showOperation:n.props.showOperation||!1,willAcceptDrag:!1,feedbackLeft:0,feedbackTop:0,showFeedback:!0,feedbackStyles:{},animationAttrs:{style:{opacity:0}},toggleClick:!0};return n.state=r,n._onMouseEnter=n._onMouseEnter.bind(n),n._onMouseLeave=n._onMouseLeave.bind(n),n._onFolderDragEnter=n._onFolderDragEnter.bind(n),n._onFolderDragLeave=n._onFolderDragLeave.bind(n),n._onDragOver=n._onDragOver.bind(n),n._onFolderDrop=n._onFolderDrop.bind(n),n._onDragStart=n._onDragStart.bind(n),n._onDragEnd=n._onDragEnd.bind(n),n._onRowClick=n._onRowClick.bind(n),n._onRowDoubleClick=n._onRowDoubleClick.bind(n),n._markOrUnMarkFile=n._markOrUnMarkFile.bind(n),n._onSettingsClick=n._onSettingsClick.bind(n),n._handleOperationHide=n._handleOperationHide.bind(n),n._hideOperation=n._hideOperation.bind(n),n._handleMenuItemClick=n._handleMenuItemClick.bind(n),n}return s(t,e),u(t,[{key:"componentDidMount",value:function(){this.dragEnterCounter=0,this.autoScroll=!1,this._updateAutoScrollRange()}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.isDragging,r=e.isDragging,i=e.isRollback,a=this.props.isDragToCrumb,o=e.isDragToCrumb;if(!n&&r)this.handleMouseMoveWhenDragging=function(e){t._onMouseMoveWhenDragging(e)},document.addEventListener("dragover",this.handleMouseMoveWhenDragging),this.setState({showFeedback:!0,feedbackStyles:{transition:"opacity .2s ease-in",opacity:1}});else if(n&&!r){"function"==typeof this.handleMouseMoveWhenDragging&&(document.removeEventListener("dragover",this.handleMouseMoveWhenDragging),delete this.handleMouseMoveWhenDragging);var l=this.state.feedbackStyles;if(a&&!o)this.setState({showFeedback:!0,feedbackStyles:{transitionProperty:"opacity, transform",transitionDuration:"0.3s",opacity:0,transform:"scale(0.5)",top:l.top,left:l.left}});else if(i){var s=this.refs.row,u=s.getBoundingClientRect(),c=u.top,d=u.left;this.setState({showFeedback:!0,feedbackStyles:{transition:"all .2s ease-out",top:c,left:d}})}else this.setState({showFeedback:!0,feedbackStyles:{transitionProperty:"opacity, transform",transitionDuration:"0.3s",opacity:0,transform:"scale(0.5)",top:l.top,left:l.left}})}!e.showOperation&&this.state.showOperation&&this.setState({showOperation:!1})}},{key:"_updateAutoScrollRange",value:function(){var e=document.getElementsByClassName("list-header-wrap")[0],t=e.getBoundingClientRect();this.scrollBottom=window.innerHeight-280,this.scrollLeft=t.left,this.scrollRight=t.Right,this.timerId=-1}},{key:"_startAutoScroll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=document.getElementsByClassName("list-container")[0],n=t.scrollHeight,r=t.clientHeight,i=t.scrollTop,a=0;a=e?i:n-i-r,this.timerId=setInterval(function(){e&&a>0?(a-=3,t.scrollTop=a):!e&&i<a&&(i+=3,t.scrollTop=i)},10)}},{key:"_stopAutoScroll",value:function(){this.timerId>-1&&(clearInterval(this.timerId),this.timerId=-1)}},{key:"_onMouseMoveWhenDragging",value:function(e){var t=this.state,n=t.feedbackLeft,r=t.feedbackTop,i=this.props.isDragToCrumb,a=e.clientX,o=e.clientY,l=this.scrollBottom,s=this.scrollLeft,u=this.scrollRight,c=!1;i||a<s||a>u?this.autoScroll=!1:(o<280?o-r<0?(this.autoScroll=!0,c=!0):this.autoScroll=!1:o>l?o-r>0?(this.autoScroll=!0,c=!1):this.autoScroll=!1:(o>280||o<l)&&(this.autoScroll=!1),this.autoScroll&&c?-1===this.timerId&&this._startAutoScroll(!0):this.autoScroll&&!c?-1===this.timerId&&this._startAutoScroll(!1):this.autoScroll||this._stopAutoScroll()),(Math.abs(a-n)>2||Math.abs(o-r)>2)&&this.setState({feedbackTop:o,feedbackLeft:a,feedbackStyles:{opacity:1,top:o+"px",left:a+"px"}})}},{key:"_openFile",value:function(e,t){t.preventDefault();var n=t.target.className.match(/(settings-[0-9a-zA-Z]{16}|list-dropdown-btn)/),i=t.target.className.match(/file-star-icon/);if(!n&&!i)if(t.ctrlKey||t.metaKey)m.default.openFile(e);else{var a=g.FILE_TYPE_MAP[e.type];a&&("folder"!==a&&window.cow.alphaFeatures.double_click&&!_?window.open("/"+a+"/"+e.guid):r("/"+a+"/"+e.guid))}}},{key:"_onRowClick",value:function(e){var t=this;return function(n){n.preventDefault(),t.state.toggleClick&&(window.cow.alphaFeatures.double_click?(n.nativeEvent.stopImmediatePropagation(),n.ctrlKey||n.metaKey?t._openFile(e,n):"function"==typeof t.props.handleSingleClick&&t.props.handleSingleClick(e)):t._openFile(e,n)),t.setState({toggleClick:!1}),setTimeout(function(){t.state.toggleClick||t.setState({toggleClick:!0})},1e3)}}},{key:"_onRowDoubleClick",value:function(e){var t=this;return function(n){window.cow.alphaFeatures.double_click?t._openFile(e,n):n.preventDefault()}}},{key:"_onMouseEnter",value:function(){this.setState({hover:"hover"})}},{key:"_onMouseLeave",value:function(){var e=this.state.showOperation;this.setState({hover:e?"hover":""})}},{key:"_onSettingsClick",value:function(e){e.nativeEvent.stopImmediatePropagation();var t=this.state.showOperation,n=this.props,r=n.clearOperation,i=n.file;"function"==typeof r&&r(i.guid),t||this.refs.fileMenu.updateName(),this.setState({showOperation:!t})}},{key:"_hideOperation",value:function(){this.setState({hover:"",showOperation:!1})}},{key:"_handleOperationHide",value:function(){var e=this.props,t=e.file,n=e.handleUpdateFile;t.isNew&&"function"==typeof n&&n(t,{isNew:!1},!0)}},{key:"_handleMenuItemClick",value:function(e){this.setState({showOperation:!1,hover:""}),this._handleOperationHide();var t=this.props,n=t.file,r=t.handleMenuItemClick;"function"==typeof r&&r(e,n)}},{key:"_markOrUnMarkFile",value:function(e){var t=this.props,n=t.file,r=t.handleMenuItemClick;e.target.className.match(/active/)?"function"==typeof r&&r("unmark",n):"function"==typeof r&&r("mark",n)}},{key:"_onDragStart",value:function(e){var t=this;if(this._updateAutoScrollRange(),this.scrollBottom=window.innerHeight-108,this.state.showOperation)return this._stopEvent(e);var n=this.props,r=n.file,i=n.handleDragStart,a=document.createElement("img");return a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",e.dataTransfer.setDragImage(a,0,0),e.dataTransfer.setData("Text",r.guid),e.dataTransfer.dropEffect="move",this.setState({hover:""},function(){setTimeout(function(){"function"==typeof i&&t.props.handleDragStart(e,r.guid,r.type)},10)}),!0}},{key:"_onFolderDragEnter",value:function(e){var t=this.props,n=t.isDragging,r=t.file;return!t.isMoving||n||!n&&1!==r.type?this._stopEvent(e):(e.preventDefault(),0===this.dragEnterCounter&&this.setState({willAcceptDrag:!0}),this.dragEnterCounter++,null)}},{key:"_onFolderDragLeave",value:function(e){var t=this.props,n=t.isDragging,r=t.file;return!t.isMoving||n||!n&&1!==r.type?this._stopEvent(e):(this.dragEnterCounter--,0===this.dragEnterCounter&&this.setState({willAcceptDrag:!1}),this._stopEvent(e))}},{key:"_onFolderDrop",value:function(e){var t=this.props,n=t.file,r=t.handleFolderDrop,i=t.handleDrop,a=t.isMoving;return this.dragEnterCounter--,a?(1===n.type&&("function"==typeof i&&i(),"function"==typeof r&&r(e,n),this.setState({willAcceptDrag:!1,hover:"hover"})),this._stopEvent(e)):this._stopEvent(e)}},{key:"_onDragOver",value:function(e){return e.dataTransfer.dropEffect="move",this._stopEvent(e)}},{key:"_onDragEnd",value:function(e){this.autoScroll=!1,this._stopAutoScroll();var t=this.props.handleDragEnd;"function"==typeof t&&t(e)}},{key:"_stopEvent",value:function(e){return e.preventDefault(),e.stopPropagation(),!1}},{key:"render",value:function(){var e,t,n=this,r=this.props,i=r.file,o=r.listType,l=r.handleUpdateFile,s=r.draggable,u=r.isDragging,c=this.state,f=c.showOperation,h=c.hover,v=c.willAcceptDrag,_=i.guid,w=i.parentId,k=i.shareCount,E=i.updatedAt,C=i.lastUsedAt,T=i.starred,O=i.lastAction,P=i.updatedUser?i.updatedUser.name||"":"",S=i.user?i.user.name||"":"",D=g.FILE_TYPE_MAP[i.type],F=i.guid===window.cow.locateFileGuid?"hover":h,M=this.props.selected?"selected":"",I=i.name,L=0===w&&k>0||w>0&&k>0,x=(e={"file-icon":!0,"file-sprite":!0},a(e,"file-"+D+"-icon",!0),a(e,"file-shared",L),e);x=(0,p.default)(x);var N="";N=L&&1!==i.type?"file-tag-icon file-shared-icon":"hide";var j="";j=T?"file-tag-icon file-star-icon active":"file-tag-icon file-star-icon";var A=(t={hover:!window.cow.alphaFeatures.double_click&&!!F,selected:M,"is-dragging":u},a(t,"table-"+D+"-row",!0),a(t,"will-accept-drag",v),t);A=(0,p.default)(A);var R=[];if("recent"===o){var U="";"open"===O?U="打开":"edit"===O&&(U="编辑"),R.push(d.default.createElement("span",{key:0,className:"file-update-time"},d.default.createElement(b.Timeago,null,C)," ",U))}else R.push(d.default.createElement("span",{key:0,className:"file-update-time"},d.default.createElement(b.Timeago,null,E))),R.push(d.default.createElement("span",{key:1,className:"file-update-user"},P));var B=function(){var e=n.state,t=e.showFeedback,r=e.feedbackStyles,i=m.default.cutLength(I,15,!0);return t?d.default.createElement("div",{className:"file-drag-feedback",style:r},d.default.createElement("i",{className:x}),d.default.createElement("span",{className:"file-name-text"},i)):null};return d.default.createElement("li",{className:"list-table-row "+A,ref:"row","data-guid":_,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,draggable:s,onDragEnter:this._onFolderDragEnter,onDragLeave:this._onFolderDragLeave,onDragOver:this._onDragOver,onDrop:this._onFolderDrop,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd},d.default.createElement("a",{href:"/"+D+"/"+_,style:{cursor:window.cow.alphaFeatures.double_click?"default":"pointer"},target:_,draggable:!1,onClick:this._onRowClick(i),onDoubleClick:this._onRowDoubleClick(i)},d.default.createElement("span",{className:"list-table-cell file-name-cell"},d.default.createElement("i",{className:j,onClick:this._markOrUnMarkFile}),d.default.createElement("i",{className:x}),d.default.createElement("span",{className:"file-name-text"},I),d.default.createElement("i",{className:N})),d.default.createElement("span",{className:"list-table-cell file-creator-cell"},d.default.createElement("span",{className:"file-creator-text"},S)),d.default.createElement("span",{className:"list-table-cell file-update-cell"},R),d.default.createElement("div",{className:"dropdown-btn list-dropdown-btn",onClick:this._onSettingsClick},d.default.createElement("span",{className:"icon-settings settings-"+_}))),d.default.createElement(y.default,{ref:"fileMenu",listType:o,handleUpdateFile:l,onHide:this._handleOperationHide,hideOperation:this._hideOperation,handleMenuItemClick:this._handleMenuItemClick,file:i,active:f}),B())}}]),t}(c.Component);t.default=w,w.propTypes={file:c.PropTypes.object,listType:c.PropTypes.string,handleUpdateFile:c.PropTypes.func,clearOperation:c.PropTypes.func,handleMenuItemClick:c.PropTypes.func,handleDragStart:c.PropTypes.func,handleFolderDrop:c.PropTypes.func,handleDrop:c.PropTypes.func,handleDragEnd:c.PropTypes.func,handleSingleClick:c.PropTypes.func,selected:c.PropTypes.bool,draggable:c.PropTypes.bool,isDragging:c.PropTypes.bool,isMoving:c.PropTypes.bool,isRollback:c.PropTypes.bool,isDragToCrumb:c.PropTypes.bool,showOperation:c.PropTypes.bool},e.exports=t.default}).call(t,n(23))},1499:function(e,t,n){(function(r,i){var a,o,l=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},s={}.hasOwnProperty;a=[n(5),n(48),n(194),n(1500),n(1501)],void 0!==(o=function(e,t,n,a,o){return function(s){function u(){return u.__super__.constructor.apply(this,arguments)}return l(u,s),u.prototype.init=function(){var e;return e=this,this.$view=r("#transfer-admin"),this.currentPick="",this.$view.click(function(t){return r(t.target).is(e.$view)?r(this).hide():t.stopPropagation()})},u.prototype.eventMap={"click .transfer-close":"hideWin","click .sure-transfer":"sureTransfer","click .transfer-list-item":"pickUser","propertychange .transfer-input":"inputChange","input .transfer-input":"inputChange","click .cancel-transfer":"hideWin"},u.prototype.domEvents={hideWin:function(){return this.$view.hide()},sureTransfer:function(e,i){var a,o;if(!r(i).hasClass("disable")&&""!==this.currentPick)return o=this,a=t.contacts[this.currentPick],-1==+a.status?n.show({okCallback:function(){return o.sendTransferRequest()},headText:"管理员转让",bodyText:a.email+" 还未接受邀请<br>确定要把管理员转让给吗？"}):this.sendTransferRequest()},pickUser:function(e,t){var n,i;return n=r(t),i=n.attr("data-user-id"),n.hasClass("is-checked")?(n.removeClass("is-checked"),this.currentPick=""):(this.$view.find(".is-checked").removeClass("is-checked"),n.addClass("is-checked"),this.currentPick=i),this.changeBtnStatus()},inputChange:function(e){var t;return t=r(e.target).val(),t?this.search(t):this.resetView(),this.currentPick="",this.changeBtnStatus()}},u.prototype.sendTransferRequest=function(){var t,n,r;return r=this,t=this.$view.find(".sure-transfer"),t.addClass("disable").text("处理中..."),n={guid:this.file.guid,new_owner_id:this.currentPick},e.post("/api/file/transfer_ownership",n,function(n){return 0===n.code?(r.$view.hide(),e.alert({title:"已转交管理员并退出共享"})):(e.alert({title:"操作失败！",type:"error"}),t.removeClass("disable").text("确认转让并退出共享"))},function(n){return e.alert({title:"操作失败！",type:"error"}),t.removeClass("disable").text("确认转让并退出共享")})},u.prototype.resetView=function(){return this.renderTransferList(this.shareUsers)},u.prototype.search=function(e){var n;return n=t.search(e,this.shareUsers),n.length?this.renderTransferList(n,"search"):this.showNoResult()},u.prototype.hideContentShadow=function(){return this.$view.find(".transfer-content-shadow").hide()},u.prototype.showContentShadow=function(){return this.$view.find(".transfer-content-shadow").show()},u.prototype.hideNoResult=function(){return this.$view.find(".transfer-no-result").hide()},u.prototype.showNoResult=function(){return this.$view.find(".transfer-no-result").show(),this.hideContentShadow()},u.prototype.changeBtnStatus=function(){var e;return e=this.$view.find(".sure-transfer"),this.currentPick?e.removeClass("disable"):e.addClass("disable")},u.prototype.renderTransferList=function(e,t){var n;return this.hideNoResult(),this.$view.find(".transfer-content-list").html(i.template(o)({userList:e})),n=this.$view.find(".transfer-content-title"),"search"===t?n.text("搜索结果"):n.text("所有成员"),e.length>5?this.showContentShadow():this.hideContentShadow()},u.prototype.showTransferList=function(t){var n;return n=this,this.file=t,e.post("/api/share/"+t.guid,{},function(t){var r,o;return 0===t.code?(r=window.cow.currentUser,o=t.data.current,n.shareUsers=i.remove(o,function(e){return e.id!==r.id}),n.$view.html(i.template(a)({})).show(),n.renderTransferList(n.shareUsers)):e.alert({title:"请求共享人失败！",type:"error"})},function(t){return e.alert({titile:"服务器出错",type:"error"})})},u.prototype.showTransferAdmin=function(e){return this.showTransferList(e)},u}(e.DomModule)}.apply(t,a))&&(e.exports=o)}).call(t,n(2),n(1))},1500:function(e,t){e.exports='<div class="transfer-box">\n    <div class="transfer-header">\n        <span class="transfer-title">转让管理员权限</span>\n        <span class="transfer-close hicon icon-close"></span>\n    </div>\n    <div class="transfer-body">\n        <div class="transfer-input-box">\n            <input class="transfer-input" placelholer="查找成员"></input>\n        </div>\n        <div class="transfer-content">\n            <div class="transfer-content-title">所有成员</div>\n            <ul class="transfer-content-list"></ul>\n            <div class="transfer-no-result">无搜索结果</div>\n        </div>\n        <div class="transfer-content-shadow"></div>\n    </div>\n    <div class="transfer-footer">\n        <span class="transfer-btn btn cancel-transfer">取消</span>\n        <span class="transfer-btn btn btn-ok disable sure-transfer">确认转让并退出共享</span>\n    </div>\n</div>'},1501:function(e,t){e.exports='<% _.each(userList, function (user) { %>\n    <li class="transfer-list-item" data-user-id="<%= user.id %>" data-user-email="<%= user.email %>">\n        <img class="transfer-item-avatar" alt="头像"/ src="<%= user.avatar %>">\n        <span class="transfer-item-username ellipsis"><%= user.name %></span>\n        <span class="transfer-item-email ellipsis"><%= user.email || \'石墨用户\' %></span>\n        <span class="transfer-item-icon doc-share-icon"></span>\n    </li>\n<% }) %>\n'},1502:function(e,t,n){(function(r,i){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),d=a(c),f=n(54),p=n(72),h=a(p),m=n(1503),v=a(m),y=n(5),g=a(y),b=n(552),_=a(b),w=n(146),k=a(w),E=n(1507),C=a(E),T=n(1438),O=a(T),P=n(9),S=a(P),D=n(20),F=a(D),M=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i={menuItems:[{display:"文档",value:"doc",label:"文档"},{display:"表格",value:"sheet",label:"表格"},{display:"文件夹",value:"folder",label:"文件夹",type:"divider"},{display:"导入",value:"new_import",label:"导入"}],supportedType:r.values(v.default.supportedTypes).join(",")},a=[];return window.cow.alphaFeatures.quill_alpha&&a.push({display:"新文档(慎点)",value:"newdoc",label:"新文档"}),a.length>0&&Array.prototype.splice.apply(i.menuItems,[3,0].concat(a)),n.state=i,n}return s(t,e),u(t,[{key:"_menuItemTpl",value:function(e,t,n,r,i){var a=t[r],o=t[i],l=function(){return"import"===t[i]||"new_import"===t[i]?d.default.createElement("span",{className:"tooltip s-tooltip right",style:{top:"6px"}},"支持Word、Excel文件"):null};return d.default.createElement("div",{"data-val":o,key:e},d.default.createElement("span",{className:"dropdown-item-icon add-item-"+o}),d.default.createElement("span",{className:"add-item-text"},a),l())}},{key:"_showEnterpriseExpiredWarning",value:function(){return!1}},{key:"_showFloderConfirm",value:function(){var e=this,t=this.props.currentFile,n=t.name?'在 "'+g.default.cutName(t.name,16)+'" 里新建文件夹':"新建文件夹";(0,C.default)({title:n,placeholderLable:"请输入文件夹的名称",confirmLabel:"新建",confirmFun:function(){var n=document.querySelector(".sm-form-control").value.trim(),r={color:"blue",name:n||"新建文件夹",type:1,parent_id:t.id};e._creatFile(r)}})}},{key:"_menuItemClick",value:function(e,t,n){if(!this._showEnterpriseExpiredWarning()){var r=this.props.currentFile,i=n.value,a=this;if("import"===i||"new_import"===i){var o="import"===i?a.refs.importInput:a.refs.newImportInput;_.default.needToGuide()&&_.default.checkIsReady().then(function(){if(cow.guideStatus.first_time_import_file)o.click();else{var e={title:"欢迎使用导入功能",description:'目前支持上传.docx/.doc/.xlsx/.xls文档，后续将开放更多格式，请关注微信公众号"石墨文档"获取新功能消息推送。',buttons:[{type:"button",buttonLabel:"确定",customClass:"btn-ok",closeAfterClick:!0,onClick:function(){return o.click()}}]};(0,k.default)(e),_.default.removeTipAjax("first_time_import_file")}})}else{var l=void 0;switch(i){case"folder":l=1;break;case"doc":l=0;break;case"spreadsheet":l=-1;break;case"sheet":S.default.notify("addNewSheet:forGuide"),l=-3;break;case"newdoc":l=-2}if(1===l)this._showFloderConfirm();else{var s={color:"blue",name:"无标题",type:l,parent_id:r.id};this._creatFile(s,i)}}}}},{key:"_creatFile",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"folder",r={guid:this.props.currentFile.guid||""};if(["favorites","recent"].indexOf(this.props.listType)>-1&&"folder"===n){i("/desktop");var a=setInterval(function(){t.props.loaded&&(h.default.createFile(e).then(function(e){i("/folder/"+e.guid)}),clearInterval(a))},200)}else h.default.createFile(e).then(function(e){var n=+e.type;if(e.authorized=!0,1!==n){window.cow.currentListByGuid[e.guid]=e,e.parent=r;var a=void 0;0===n?a="doc":-1===n?a="spreadsheet":-3===n?a="sheet":-2===n&&(a="newdoc"),-3===n?_.default.checkIsReady().then(function(t){_.default.removeTipAjax("new_sheet_guide");var n=t.new_sheet_guide?"":"?from=new-sheet-guide";i("/"+a+"/"+e.guid+n)}):i("/"+a+"/"+e.guid)}else{i("/folder/"+e.guid);var o=t.props,l=o.currentFile,s=o.dispatch;(l.children||[]).every(function(t){return e.id!==t.id})&&(e.isNew=!0,s(O.default.addFile(e)))}},function(e){g.default.alert({title:e.error,type:"error"})})}},{key:"_inputChange",value:function(e,t){var n=t.target.files[0],r=n.size,i=20;/\.doc$/.test(n.name)&&(i=100),t.target.form.reset(),r>1024*i*1024?g.default.alert({title:"不能上传超过 "+i+"M 的文件",type:"error"}):v.default.import(n,e)}},{key:"_selectedTpl",value:function(){return d.default.createElement("div",null,d.default.createElement("a",{className:"add-entry-btn"},"新建"),d.default.createElement("div",{className:"tooltip s-tooltip right no-permission"},"没有新建文件权限"))}},{key:"render",value:function(){var e=this.props.dropdownAtCenter,t=this.state,n=t.menuItems,r=t.supportedType,i=(0,F.default)({"sm-add-drawer":!0,"dropdown-at-center":e});return d.default.createElement("div",{className:i},d.default.createElement("form",{style:{display:"none"},encType:"multipart/form-data",method:"post",action:"javascript:;",role:"form",id:"ajax-upload"},d.default.createElement("input",{ref:"importInput",type:"file",name:"files",onChange:this._inputChange.bind(this,"import"),accept:r}),d.default.createElement("input",{ref:"newImportInput",type:"file",name:"files",onChange:this._inputChange.bind(this,"new_import"),accept:r})),d.default.createElement(f.DropdownMenu,{menuItems:n,displayKey:"display",valKey:"value",wrapClassName:"add-entry-wrap",forceTap:!0,itemTpl:this._menuItemTpl,selectedTpl:this._selectedTpl,onMenuChange:this._menuItemClick.bind(this)}))}}]),t}(c.Component);t.default=M,M.propTypes={currentFile:c.PropTypes.object,listType:c.PropTypes.string,loaded:c.PropTypes.bool,dispatch:c.PropTypes.func,dropdownAtCenter:c.PropTypes.bool},e.exports=t.default}).call(t,n(1),n(23))},1503:function(e,t,n){(function(r,i){var a,o;a=[n(5),n(194),n(573),n(30),n(1),n(200),n(53)],void 0!==(o=function(e,a,o,l,s,u,c){var d;return d=function(){var e;return e=r("input#import-file"),e.replaceWith(e=e.val("").clone())},t.supportedTypes={docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},t.import=function(f,p){var h,m;return h=f.name.split(".").pop(),s.includes(["xls","xlsx"],h)?(m=function(t,n,o,l){return r.ajax({url:"/import/sheet",type:"POST",data:{name:t.replace(/\.xlsx$/,""),delta:n,parent:o},success:function(t){return void 0!==t.code?(console.log(t),a.show({headText:"表格导入失败",bodyText:"您导入的「"+f.name.replace(/\.xlsx$/,"")+"」失败，请尝试用 excel 另存为后再导入",okText:"好的",buttons:["ok"]})):(e.hide(),a.show({okCallback:function(){return i("/sheet/"+t.guid)},cancelCallback:function(){var e;if(e=window.location.pathname,/folder/.test(e)||/desktop/.test(e))return window.location.reload()},headText:"表格导入成功",bodyText:"您导入的「"+f.name.replace(/\.xlsx$/,"")+"」已经成功，是否查看",okText:"立刻查看",cancelText:"稍后再说",buttons:["ok","cancel"]}),l.terminate()),d()}})},n.e(39).then(function(t){var i,d,v,y;return i=n(1504),d=n(1505),y=new i,y.onerror=function(t){return console.log(t.filename,t.lineno,t.message),o(t.message,"import_helper.coffee",t.lineno,0,t),e.alert({title:"导入出错，请重试。",type:"error"})},y.onmessage=function(t){var n,i,o,l;return t.data.isStandard?(n=t.data.result,s.isEmpty(t.data.sheetsImages)?(n=d.compressToEncodedURIComponent(JSON.stringify(n)),e.hide(),e.alert({title:"解析完成，上传服务器中",delay:12e5}),m(f.name,n,v,y)):(i={},l=function(t,n,a,o){return new Promise(function(l,s){var c,d,f,p,h,m,v;for(f=t.split(","),p=f[0].split("/")[1],c=e.base64toBlob(f[1],p),m=[{fields:{file:c},guid:n,filename:n,type:"blob"}],v=[],d=0,h=m.length;d<h;d++)m[d],v.push(r.ajax({url:"/smapi/action/create_upload_forms",type:"POST",data:JSON.stringify([n]),contentType:"application/json",success:function(e){var t;return m[0].fields.token=e.data[0].token,m[0].fields.key=e.data[0].key,t=new u({url:"https://up.qbox.me",fileQueue:m,onUploadComplete:function(e,t){var n;return n='["'+e.data.images+'",'+(o.x-1)+","+(o.y-1)+","+Math.round(o.width)+","+Math.round(o.height)+"]",void 0===i[a]&&(i[a]=[]),i[a].push(n),l()}}),t.uploadFiles1By1()}}));return v})},o=[],s.forEach(t.data.sheetsImages,function(t,n){return s.forEach(t,function(t){var r,a;return s.isEmpty(t)?o.push(new Promise(function(e,t){return void 0===i[n]&&(i[n]=[]),i[n].push(""),e()})):(r=e.genGuid("import"),a=t.src.split(";")[0].split("/")[1],o.push(l(t.src,r+"."+a,n,t)))})}),Promise.all(o).then(function(){var r,a,o;return[],o=t.data.sheetsKeys,a=[],s.forEach(i,function(t,n){var r;return r={},r.name=o[n],s.forEach(t,function(t){if(!s.isEmpty(t))return r["picture-"+e.genGuid()]=t}),a.push(new c.TableOperator({action:"retain",data:1,attributes:r}))}),s.isEmpty(a)||(r=new c.Delta(a),n=c.pack(c.unpack(n).compose(r))),n=d.compressToEncodedURIComponent(JSON.stringify(n)),e.alert({title:"解析完成，上传服务器中",delay:12e5}),m(f.name,n,v,y)}))):(e.hide(),a.show({headText:"表格导入失败",bodyText:"您的表格可能已损坏，请用 excel 另存为后再导入",okText:"好的",buttons:["ok"]}))},v=cow.currentFile.id||0,"undefined"==typeof Worker||l.isIE()?e.alert({title:"您的浏览器不支持导入，请更换为最新版的 Chrome/Firefox 浏览器"}):s.includes(["xlsx"],h)?(e.alert({title:"正在导入表格",content:"导入已在后台运行，成功后会在此标签页提示您，处理大文件耗时较长，在此期间您可以进行其他操作",delay:12e5}),y.postMessage({file:f,type:p})):a.show({headText:"表格导入失败",bodyText:"不支持 xls 文件导入，请用 excel 另存为 xlsx 文件后再导入",okText:"好的",buttons:["ok"]})}.bind(null,n)).catch(n.oe)):n.e(37).then(function(a){var o,c,p,m,v,y,g,b,_,w,k,E,C;return o=n(196),c=n(88),p=n(988),u=n(200),_="",m=function(e,t){var n,r,i,a,o,l;for(n=c.opIterator(e),l=0,i=0,r=_.length;n.hasNext();)o=n.next(),a=l+o.chars,a<=i||l>=r||t(Math.max(i,l),Math.min(r,a),o.attribs),l=a},k=function(e){var t,n;return n=document.createElement("iframe"),n.style.display="none",document.body.appendChild(n),n.contentDocument.open(),n.contentDocument.write(e),n.contentDocument.close(),t=n.contentDocument.body,document.body.removeChild(n),t},b=function(e){var n,r,i,a,l,s;return _="",n=new o,n.putAttrib(["addition",!0]),n.putAttrib(["deletion",!0]),r=n.putAttrib(["author",cow.currentUser.id]),a=p.makeContentCollector(!0,null,n),l=k(e),a.collectContent(l),t.apool=n,e=a.finish(),_=e.lines.join("\n"),s=e.lineAttribs.join("|1+1")+"|1+1",i=c.builder(1),m(s,function(e,t,n){return i.insert(_.substring(e,t),"*"+r+n)}),i.toString()},g=function(e){return e?e.replace(/\.docx?$/,""):"导入 Word 文档"},w=function(e,n,a){return r.ajax({url:"/import/doc",data:{changeset:b(e),apool:JSON.stringify(t.apool),title:g(n),parent:a||0},type:"POST",success:function(e){return i("/doc/"+e.guid),d()}})},"undefined"!=typeof Worker&&!l.isIE()&&s.includes(["docx"],h)?(e.alert({title:"正在导入文档",content:"导入已在后台运行，成功后会在此标签页提示您，处理大文件耗时较长，在此期间您可以进行其他操作",delay:3e4}),y=n(1506),C=new y,C.postMessage(f),E=[],C.onerror=function(e){return console.log(e.filename,e.lineno,e.message)},C.onmessage=function(t){var n,i,a,o,l,s,c,d,p,h,m;for(m=function(t,n){return new Promise(function(i,a){var o,l,s,c,d;for(o=e.base64toBlob(t.split(",")[1],"png"),c=[{fields:{file:o},guid:n,filename:n,type:"blob"}],d=[],l=0,s=c.length;l<s;l++)c[l],d.push(r.ajax({url:"/smapi/action/create_upload_forms",type:"POST",data:JSON.stringify([n]),contentType:"application/json",success:function(e){var n;return c[0].fields.token=e.data[0].token,c[0].fields.key=e.data[0].key,n=new u({url:"https://up.qbox.me",fileQueue:c,onUploadComplete:function(e,n){return E.push([t,e.data.images]),i()}}),n.uploadFiles1By1()}}));return d})},e.hide(),i=t.data,p=new DOMParser,n=p.parseFromString(t.data,"text/html"),c=n.querySelectorAll("img"),h=[],a=0,d=c.length;a<d;a++)o=c[a],(s=o.attributes.src.value)&&(l=e.genGuid("import"),h.push(m(s,l+".png")));return Promise.all(h).then(function(){var e,t,n;for(t=0,n=E.length;t<n;t++)e=E[t],i=i.replace(e[0],e[1]);return C.terminate(),w(i,f.name,cow.currentFile.id)})}):(v=new FormData,v.append("files",f),v.append("parent",cow.currentFile.id||0),e.alert({title:"正在导入…"}),new Promise(function(e){e()}).then(function(){return r.ajax({url:"/import/doc",type:"POST",data:v,cache:!1,contentType:!1,processData:!1,success:function(t){return 500===t.code?(e.alert({title:"导入出错，请重试。",type:"error"}),d()):(e.hide(),w(t,f.name,cow.currentFile.id))}})}.bind(null,n)).catch(n.oe))}.bind(null,n)).catch(n.oe)},t}.apply(t,a))&&(e.exports=o)}).call(t,n(2),n(23))},1507:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=document.body.appendChild(document.createElement("div")),n=function(){return t.parentNode.removeChild(t)},r=e||{};r.cleanup=n,l.default.render(a.default.createElement(u.default,r),t)};var i=n(0),a=r(i),o=n(13),l=r(o),s=n(1508),u=r(s);e.exports=t.default},1508:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(5),d=r(c);n(1509);var f=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={disabled:"disabled"},n.confirm=n.confirm.bind(n),n.abort=n.abort.bind(n),n.cleanup=n.cleanup.bind(n),n.onInputChange=n.onInputChange.bind(n),n.onInputKeyPress=n.onInputKeyPress.bind(n),n.handleWrapClick=n.handleWrapClick.bind(n),n}return o(t,e),l(t,null,[{key:"PropTypes",get:function(){return{customClass:u.default.PropTypes.string,title:u.default.PropTypes.string,placeholderLable:u.default.PropTypes.string,confirmLabel:u.default.PropTypes.string,abortLabel:u.default.PropTypes.string,confirmClass:u.default.PropTypes.string,abortClass:u.default.PropTypes.string,confirmFun:u.default.PropTypes.func,abortFun:u.default.PropTypes.func}}},{key:"defaultProps",get:function(){return{customClass:"",title:"",placeholderLable:"",confirmLabel:"确定",abortLabel:"取消",confirmClass:"",abortClass:"",confirmFun:function(){},abortFun:function(){}}}}]),l(t,[{key:"renderDialogBody",value:function(){return u.default.createElement("div",{className:"prompt-dialog-content"},u.default.createElement("input",{placeholder:this.props.placeholderLable,ref:"input",className:"sm-form-control",onChange:this.onInputChange,onKeyPress:this.onInputKeyPress,autoFocus:!0}))}},{key:"renderFooter",value:function(){return u.default.createElement("div",{className:"prompt-dialog-footer"},u.default.createElement("button",{role:"confirm",type:"button",className:"btn btn-ok "+this.props.confirmClass+this.state.disabled,ref:"confirm",onClick:this.confirm,disabled:this.state.disabled},this.props.confirmLabel),u.default.createElement("button",{role:"abort",type:"button",className:"btn "+this.props.abortClass,onClick:this.abort},this.props.abortLabel))}},{key:"confirm",value:function(){this.props.confirmFun(),this.cleanup()}},{key:"abort",value:function(){this.props.abortFun(),this.cleanup()}},{key:"cleanup",value:function(){this.props.cleanup&&this.props.cleanup()}},{key:"onInputChange",value:function(){var e=this.refs.input,t=e.value.trim();this.setState({disabled:t?"":"disabled"})}},{key:"onInputKeyPress",value:function(e){e.charCode===d.default.keyCodes.ENTER&&(this.props.confirmFun(),this.cleanup())}},{key:"handleWrapClick",value:function(e){e.target.className.indexOf("prompt-wrap")>-1&&this.abort()}},{key:"render",value:function(){return u.default.createElement("div",{className:"prompt-wrap",onClick:this.handleWrapClick},u.default.createElement("div",{className:"prompt-dialog "+this.props.customClass},u.default.createElement("div",{className:"prompt-dialog-header"},u.default.createElement("span",null,this.props.title),u.default.createElement("span",{className:"hicon icon-close prompt-close",onClick:this.abort})),this.renderDialogBody(),this.renderFooter()))}}]),t}(s.Component);t.default=f,e.exports=t.default},1509:function(e,t){},1510:function(e,t){},1511:function(e,t){},1512:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),d=n(1513),f=r(d),p=n(1453),h=r(p),m=n(20),v=r(m),y=n(1516),g=r(y);n(1517);var b=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"_openTrash",value:function(){this.refs.trash.show()}},{key:"render",value:function(){var e=this.props,t=(0,v.default)({"sm-list-sidebar":!0}),n=e.scrollLeft,r={};return n>=0?r.left=20-n+"px":r={},c.default.createElement("div",{className:t,style:r},c.default.createElement(h.default,e),c.default.createElement(f.default,l({},e,{openTrash:this._openTrash.bind(this)})),c.default.createElement(g.default,{ref:"trash"}))}}]),t}(u.Component);t.default=b,b.propTypes={loaded:u.PropTypes.bool,scrollLeft:u.PropTypes.number,dispatch:u.PropTypes.func,enableDrop:u.PropTypes.bool,files:u.PropTypes.array,currentFile:u.PropTypes.object,currentUser:u.PropTypes.object},e.exports=t.default},1513:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1514),a=r(i);n(1515),t.default=a.default,e.exports=t.default},1514:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=i(u),d=n(1140),f=i(d),p=n(146),h=i(p),m=n(5),v=i(m),y=n(22),g=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={willAcceptDropTag:"",addMemberVisible:!1},n.openAddMember=n.openAddMember.bind(n),n.onAddMemeberClose=n.onAddMemeberClose.bind(n),n}return l(t,e),s(t,[{key:"componentWillMount",value:function(){var e=this;(0,y.ajaxGet)("/smapi/teams/mine/permissions").then(function(t){var n=t.code,r=t.data;0===n&&e.setState({permissions:r})})}},{key:"_onListItemClick",value:function(e){var t=e.currentTarget,n=t.getAttribute("data-href");n!==location.pathname&&r(n)}},{key:"_onDrop",value:function(e){return this.props.enableDrop?(e.currentTarget.className.match(/active/)&&e.preventDefault(),this.setState({willAcceptDropTag:""}),this._stopEvent(e)):this._stopEvent(e)}},{key:"_onDragEnter",value:function(e){return this.props.enableDrop?(e.currentTarget.className.match(/active/)?e.preventDefault():this.setState({willAcceptDropTag:"desktop"}),e.preventDefault()):this._stopEvent(e)}},{key:"_onDragLeave",value:function(){this.setState({willAcceptDropTag:""})}},{key:"_onDragOver",value:function(e){e.preventDefault()}},{key:"_stopEvent",value:function(e){return e.stopPropagation(),e.preventDefault(),!1}},{key:"_isActive",value:function(e){var t=location.pathname;return t===e?"active":e.match(/\/desktop\b/)&&t.match(/\/folder\/[0-9a-zA-Z]{16}\b/)?"active":""}},{key:"_openTrash",value:function(){var e=this.props.openTrash;"function"==typeof e&&e(),this.props.openTrash()}},{key:"openEnterpriseManger",value:function(){v.default.isDingtalkPc()?window.location.href="/enterprise":window.open("/enterprise")}},{key:"openAddMember",value:function(){var e=this.props.currentUser,t=this.state.permissions.invite;Array.isArray(t)&&t.indexOf(e.team_role)>=0?this.setState({addMemberVisible:!0}):this.openAddMemberWarning()}},{key:"openAddMemberWarning",value:function(){var e={title:"添加新成员",description:"没有权限，请联系企业管理员添加",buttons:[{type:"button",buttonLabel:"确定",customClass:"btn-ok",closeAfterClick:!0}]};(0,h.default)(e)}},{key:"onAddMemeberClose",value:function(){this.setState({addMemberVisible:!1})}},{key:"renderInvitation",value:function(){var e=this.props.currentUser;return["personal_premium","personal_free"].indexOf(e.accountType)>-1||"member"===e.team_role?null:c.default.createElement(f.default,{open:this.state.addMemberVisible,onClose:this.onAddMemeberClose})}},{key:"renderEnterpriseSettings",value:function(){var e=this.props.currentUser;return["personal_premium","personal_free"].indexOf(e.accountType)>-1||"member"===e.team_role?null:[c.default.createElement("li",{key:0,className:"list-tab-header"},"我的企业"),c.default.createElement("li",{key:1,className:"list-tab enterprise",onClick:this.openEnterpriseManger},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"企业管理"),c.default.createElement("li",{key:2,className:"list-tab member",onClick:this.openAddMember},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"添加成员")]}},{key:"render",value:function(){var e=this,t=this.props.enableDrop,n=this.state.willAcceptDropTag,r=function(){return" "+(e._isActive.bind(e)("/desktop")?"active":t?"ondrag":"")+" "+("desktop"===n?"scale":"")+" "};return c.default.createElement("ul",{className:"sm-list-tabs"},c.default.createElement("li",{"data-href":"/desktop",className:"list-tab desktop "+r(),onDragEnter:this._onDragEnter.bind(this),onDragLeave:this._onDragLeave.bind(this),onDragOver:this._onDragOver.bind(this),onDrop:this._onDrop.bind(this),onClick:this._onListItemClick.bind(this)},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"我的桌面"),c.default.createElement("li",{className:"list-tab recent "+this._isActive.bind(this)("/recent"),"data-href":"/recent",onClick:this._onListItemClick.bind(this)},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"最近使用"),c.default.createElement("li",{className:"list-tab favorites "+this._isActive.bind(this)("/favorites"),"data-href":"/favorites",onClick:this._onListItemClick.bind(this)},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"标星文件"),c.default.createElement("li",{className:"list-tab trash",onClick:this._openTrash.bind(this)},c.default.createElement("span",{className:"file-sprite list-tab-icon"}),"回收站"),this.renderEnterpriseSettings(),c.default.createElement("li",null,this.renderInvitation()))}}]),t}(u.Component);t.default=g,g.propTypes={dispatch:u.PropTypes.func,enableDrop:u.PropTypes.bool,files:u.PropTypes.array,currentFile:u.PropTypes.object,currentUser:u.PropTypes.object,openTrash:u.PropTypes.func},e.exports=t.default}).call(t,n(23))},1515:function(e,t){},1516:function(e,t,n){(function(r,i){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),d=a(c),f=n(5),p=a(f),h=n(9),m=a(h),v=n(194),y=a(v),g=n(270),b=function(e){function t(e){o(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={files:[],selected:[],show:!1},m.default.on("trash:show",function(){n.setState({show:!0}),n._load()}),r(window).keydown(n._shortcut.bind(n)),n}return s(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.show&&e.show!==this.state.show&&(this.setState({show:e.show}),e.show&&this._load())}},{key:"show",value:function(){this.setState({show:!0}),this._load(),r(window).keydown(this._shortcut.bind(this))}},{key:"_load",value:function(){var e=this;p.default.get("/api/trash",function(t){e.setState({files:t.data})},function(){p.default.alert({title:"获取回收站数据时出现问题",type:"error"})})}},{key:"_isMetaKeyPressed",value:function(e){return p.default.isMac()&&e.metaKey||!p.default.isMac()&&e.ctrlKey}},{key:"_shortcut",value:function(e){this.state.show&&(this._isMetaKeyPressed(e)&&65===e.keyCode?(e.preventDefault(),this._selectAll()):27===e.keyCode&&this._unselectAll())}},{key:"_unselectAll",value:function(){i.each(this.state.selected,function(e){e.selected=!1}),this.state.selected.splice(0,this.state.selected.length),this.setState({selected:this.state.selected})}},{key:"_selectAll",value:function(){var e=i.map(this.state.files,function(e){return e.selected=!0,e});this.setState({selected:e})}},{key:"_hide",value:function(e){e.target===e.currentTarget&&(this._unselectAll(),this.setState({show:!1}))}},{key:"_delete",value:function(){var e=this;if(this.state.selected.length){var t=i.map(this.state.selected,"id");y.default.show({headText:"彻底删除文件",bodyText:"即将彻底删除 "+t.length+" 个文件。删除后将无法恢复，请谨慎操作！",okText:"彻底删除",okCallback:function(){p.default.post("/api/trash/remove",{files:t},function(){e._clearSelectedFile(t),p.default.alert({title:"成功彻底删除 "+t.length+" 个文件"})},function(){p.default.alert({title:"删除失败",type:"error"})})}})}}},{key:"_clearSelectedFile",value:function(e){i.remove(this.state.files,function(t){return-1!==e.indexOf(t.id)}),this.setState({selected:[]})}},{key:"_tip",value:function(){var e=void 0,t=this.state.selected.length;return t?(e="已选择 "+t+" 个文件",e=d.default.createElement("span",{className:"t-tip active"},e)):(e="Shift或Ctrl复选，Ctrl+A全选。",p.default.isMac()&&(e=e.replace(/Ctrl/g,"Cmd")),e=d.default.createElement("span",{className:"t-tip"},e)),e}},{key:"_recover",value:function(){var e=this;if(this.state.selected.length){var t=i.map(this.state.selected,"id");p.default.post("/api/trash/restore",{files:t},function(){e._clearSelectedFile(t),p.default.alert({title:"已成功恢复至我的桌面"})},function(){p.default.alert({title:"恢复失败，请重试，或者联系我们的技术人员",type:"error"})})}}},{key:"_renderFiles",value:function(){var e=this,t={"-1":"spreadsheet","-3":"spreadsheet",0:"doc",1:"folder"};return this.state.files.length>0?this.state.files.map(function(n){var r=n.selected?"t-item selected":"t-item",i=n.name.length<30?n.name:n.name.substring(0,30)+"...",a="icon file-folder-sprite "+t[n.type];return d.default.createElement("div",{key:n.id,className:r,onClick:e._select.bind(e,n)},d.default.createElement("div",{className:a}),d.default.createElement("div",null,d.default.createElement("div",{className:"t-filename"},i),d.default.createElement("div",{className:"t-update-time"},d.default.createElement(g.Timeago,{within1Hour:!0,after:"更新"},n.updated_at))))}):d.default.createElement("div",{className:"list-empty"},d.default.createElement("div",{className:"list-empty-icon"}),d.default.createElement("div",{className:"list-empty-text"},"你一定有洁癖"))}},{key:"_select",value:function(e,t){var n=this,r=this.state.selected,a=void 0,o=void 0;if(t.shiftKey&&(a=0,r.length&&(a=i.indexOf(this.state.files,r[r.length-1])),o=i.indexOf(this.state.files,e),a>o)){var l=[o,a];a=l[0],o=l[1]}!t.shiftKey&&this._isMetaKeyPressed(t)||this._unselectAll(),t.shiftKey?i.each(this.state.files,function(e,t){t>=a&&t<=o&&n._selectFile(e)}):this._selectFile(e),this.setState({selected:this.state.selected})}},{key:"_selectFile",value:function(e){e.selected=!e.selected,e.selected?this.state.selected.push(e):i.remove(this.state.selected,function(t){return t.id===e.id})}},{key:"render",value:function(){if(!this.state.show)return null;var e="btn btn-ok t-recover";e+=this.state.selected.length?"":" disable";var t="btn-clear ";return t+=this.state.selected.length?"disable":"",d.default.createElement("div",{id:"trash",onClick:this._hide.bind(this)},d.default.createElement("div",{className:"t-inner"},d.default.createElement("div",{className:"t-header"},d.default.createElement("span",{className:"t-title"},"回收站"),d.default.createElement("div",{className:"s-tip"},d.default.createElement("span",{className:"team-sprite help-icon"}),d.default.createElement("div",{className:"s-tooltip"},"空文档/表格/文件夹会被彻底删除，不会进入回收站")),d.default.createElement("span",{className:"hicon icon-close t-close",onClick:this._hide.bind(this)})),d.default.createElement("div",{className:"t-body"},this._renderFiles()),d.default.createElement("div",{className:"t-footer"},this._tip(),d.default.createElement("span",{className:t,onClick:this._delete.bind(this)},"彻底删除"),d.default.createElement("button",{className:e,onClick:this._recover.bind(this)},"恢复"))))}}]),t}(d.default.Component);t.default=b,e.exports=t.default}).call(t,n(2),n(1))},1517:function(e,t){},1518:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(){function e(){var e=r("#email-verify");if(0!==e.length){var n=cow.currentUser.email;if(n){var i=n.substr(n.indexOf("@")+1),a=l.default.emailList[i];a&&e.find(".current-email").attr("href","http://"+a),t()}}}function t(){r("#email-verify .email-verify-send.active").on("click",function(){n()}),r(".email-verify-close").on("click",function(){i()})}function n(){var e=r("#email-verify .email-verify-send");l.default.post("/api/resend_activation_mail",{},function(){l.default.alert({title:"激活邮件发送成功，请前往激活"}),e.removeClass("active").text("已发送")},function(){l.default.alert({title:"激活邮件发送失败，请重试",type:"error"})})}function i(){r("#email-verify").hide(),l.default.post("/flash_messages/read",{message_name:"verify_email"},function(){console.log("close verify email")})}e()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var o=n(5),l=i(o);e.exports=t.default}).call(t,n(2))},1519:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=i(u),d=n(552),f=i(d),p=n(51),h=i(p),m=n(72),v=i(m),y=n(745);n(1520);var g=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={open:!1},n.bodyTpl=n.bodyTpl.bind(n),n._onClose=n._onClose.bind(n),n}return l(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this;new Date(2017,2,3)>new Date(window.cow.currentUser.createdAt)&&f.default.checkIsReady().then(function(t){t.new_sheet_guide?e.setState({open:!1}):e.setState({open:!0})})}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.open!==t.open}},{key:"bodyTpl",value:function(){return c.default.createElement("div",{className:"new-sheet-guide-modal-wrap"},c.default.createElement("div",{className:"n-s-g-content-wrap"},c.default.createElement("div",{className:"n-s-g-icon code"}),c.default.createElement("div",{className:"n-s-g-content"},c.default.createElement("div",{className:"n-s-g-title"},"性能大幅提升"),c.default.createElement("p",{className:"n-s-g-desc"},"我们全面优化了表格的底层架构，在处理大量数据和公式时更加流畅顺滑。"))),c.default.createElement("div",{className:"n-s-g-content-wrap"},c.default.createElement("div",{className:"n-s-g-icon utils"}),c.default.createElement("div",{className:"n-s-g-content"},c.default.createElement("div",{className:"n-s-g-title"},"新增多项功能"),c.default.createElement("p",{className:"n-s-g-desc"},"支持条件格式、边框线、超链接、跨表引用、拖动替换、400多种公式等。"),c.default.createElement("p",{className:"n-s-g-tip"},"*为了更好的体验，目前仅新创建的表格为新版表格。"))))}},{key:"goNewSheet",value:function(){var e={color:"blue",name:"无标题",type:-3};(0,y.checkEnterpriseExpired)()||v.default.createFile(e).then(function(e){r("/sheet/"+e.guid+"?from=new-sheet-guide")}),this.setState({open:!1}),f.default.removeTipAjax("new_sheet_guide")}},{key:"_onClose",value:function(){f.default.removeTipAjax("new_sheet_guide")}},{key:"render",value:function(){var e=[{customClass:"btn btn-ok go-new-sheet-btn",label:"立即体验",onTap:this.goNewSheet.bind(this)}];return c.default.createElement(h.default,{ref:"newSheetGuide",customClass:"new-sheet-guide-modal",title:"表格全面升级",hasCloseButton:!0,open:this.state.open,onClose:this._onClose,enableCloseClickMask:!0,actions:e,bodyTpl:this.bodyTpl})}}]),t}(u.Component);t.default=g,e.exports=t.default}).call(t,n(23))},1520:function(e,t){},1521:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(151),a=n(672),o=r(a),l=n(744),s=r(l),u=n(1522),c=r(u),d=n(252),f={storage:{}},p=(0,i.combineReducers)({list:c.default,modals:d.reducer,storage:s.default});t.default=(0,o.default)(p,f),e.exports=t.default},1522:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(){var e=p.default.getJSON("shimo_list_order_rule")||{};return{orderBy:e.orderBy||"updated_at",orderType:e.orderType||"desc"}}function o(){return(p.default.getJSON("shimo_desktop_mode")||{})[cow.currentUser.id]||"tiled"}function l(){var e={loading:!0,loaded:!1,isMoving:!1,isDragToCrumb:!1,listType:cow.listType,currentFile:cow.tempCurrentFile,currentUser:cow.currentUser,files:[],orderedFiles:[],gridMode:o(),orderRule:a(),alphaFeatures:cow.alphaFeatures||{},pagination:-1,pageSize:y.recentPagesize,recentHasNoMore:!1},t=e.gridMode,n=e.orderRule;return"table"===t&&(e.orderedFiles=s(e.orderedFiles,n)),e}function s(e,t){var n=t.orderBy,r=t.orderType,i=[].concat(e),a=[],o=[];i.forEach(function(e){e.creator=e.creator||(e.user?e.user.name||"":""),1==+e.type?o.push(e):a.push(e)});var l=[n,"name"===n?"updated_at":"name"];if("name"===n){var s=l[1],u=function(e,t){var n=e.name.localeCompare(t.name);if(0!==n){return n*("asc"===r?1:-1)}return e[s]>t[s]?1:e[s]<t[s]?-1:0},c=a.sort(u),d=o.sort(u);return"asc"===r.toLowerCase()?d.concat(c):c.concat(d)}return m.default.orderBy(i,l,[r.toLowerCase()||"desc","asc"])}function u(e){var t=e.gridMode,n=e.orderRule,r=e.files;"recent"!==e.listType&&"table"===t&&(e.orderedFiles=s(r,n))}function c(e,t){return m.default.assign({},e,t)}function d(e,t,n){var r=[].concat(e);if(t===n)return r;var i=r[t];return t>n?(r.splice(n,0,i),r.splice(t+1,1)):(r.splice(n+1,0,i),r.splice(t,1)),r}Object.defineProperty(t,"__esModule",{value:!0});var f=n(89),p=r(f),h=n(1),m=r(h),v=n(272),y=n(147),g=function(e,t){var n=e.currentUser,r=p.default.getJSON("shimo_desktop_mode")||{};r[n.id]=t,p.default.set("shimo_desktop_mode",JSON.stringify(r),{expires:365});var i=c(e,{gridMode:t});return u(i),i},b=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",r=p.default.getJSON("shimo_list_order_rule")||{orderBy:"updated_at",orderType:"desc"};r.orderType!==n&&(r.orderType=n),t&&r.orderBy!==t&&(r.orderBy=t),p.default.set("shimo_list_order_rule",JSON.stringify(r),{expires:365});var i=c(e,{orderRule:r});return u(i),i},_=function(e){return c(e,{files:[]})},w=function(e){return c(e,{loaded:!1,loading:!0,listType:cow.listType,recentHasNoMore:!1})},k=function(e,t){var n=(0,v.sortByDay)([].concat(t.children||[])),r=e.files||[];if(r.length&&n.length&&r.slice(-1)[0].timestamp===n[0].timestamp){var i=r.slice(-1)[0],a=n.shift();i.files=i.files.concat(a.files)}return c(e,{files:r.concat(n),pagination:e.pagination+1,loading:!1,loaded:!0,recentHasNoMore:t.children.length<e.pageSize})},E=function(e,t){if((t.children||[]).forEach(function(e){e.authorized=void 0===e.authorized||e.authorized}),"recent"===e.listType)return k(c(e,{pagination:-1,files:[]}),t);var n=c(e,{loaded:!0,loading:!1,files:[].concat(t.children||[]),currentFile:t});return u(n),n},C=function(e,t){return c(e,{loaded:!0,loading:!1,error:t})},T=function(e,t){if("recent"===e.listType)return e;var n=c({},t);if(e.files.some(function(e){return e.id===t.id}))return e;var r=[n].concat(i(e.files)),a=c(e,{files:r});return u(a),a},O=function(e,t){var n=[].concat(t),r=m.default.intersectionBy(e.files,n,"guid"),a=m.default.differenceBy(n,r,"guid"),o=[e.files].concat(i(a)),l=c(e,{files:o});return u(l),l},P=function(e,t){var n=e.files.filter(function(e){return e.guid!==t}),r=c(e,{files:n});return u(r),r},S=function(e,t,n){var r=[].concat(e.files);return r=d(r,t,n),c(e,{files:r})},D=function(e){return c(e,{isMoving:!0,files:[].concat(e.files)})},F=function(e){return c(e,{files:[].concat(e.files)})},M=function(e){return c(e,{isMoving:!1,files:[].concat(e.files)})},I=function(e){return c(e,{isMoving:!1,files:[].concat(e.files)})},L=function(e,t,n){var r=[].concat(e.files);return r=d(r,n,t),c(e,{isMoving:!1,files:r})},x=function(e,t,n){var r=[].concat(e.files);n.hasOwnProperty("is_delete")&&+n.is_delete>=1?"recent"===e.listType?r.some(function(e){return e.files.some(function(e,n){return e.guid===t&&(r.splice(n,1),!0)})}):r.some(function(e,n){return e.guid===t&&(r.splice(n,1),!0)}):"recent"===e.listType?r.map(function(e){var r=e.files||[];return e.files=r.map(function(e){if(e.guid===t){return c(e,n)}return e}),e}):r=r.map(function(e){return e.guid===t?c(e,n):e});var i=c(e,{files:r});return u(i),i},N=function(e,t){return c(e,{isDragToCrumb:t})};t.default=function(e,t){switch(e=e||l(),t.type){case"CLEAR_LIST":return _(e);case"LIST_LOAD":case"RECENT_PAGINATION_LOAD":return w(e);case"LIST_LOAD_SUCCESS":return E(e,t.result);case"LIST_LOAD_FAIL":case"RECENT_PAGINATION_FAIL":return C(e,t.error);case"ADD_FILE":return T(e,t.file);case"ADD_FILES":return O(e,t.files);case"DELETE_FILE":return P(e,t.guid);case"MOVE_FILE":return S(e,t.fromIndex,t.toIndex);case"PREPARE_MOVE":return D(e,t.guid);case"START_MOVE":return F(e,t.fromIndex,t.toIndex);case"CANCEL_MOVE":return I(e,t.guid,t.fromIndex,t.toIndex);case"ROLLBACK_MOVE":return L(e,t.originIndex,t.newIndex);case"END_MOVE":return M(e);case"UPDATE_FILE":return x(e,t.guid,t.newAttrs);case"CHANGE_GRID_MODE":return g(e,t.newMode);case"CHANGE_ORDER_RULE":return b(e,t.orderBy,t.orderType);case"PREPARE_DRAG_TO_CRUMB":return N(e,t.isEnter);case"RECENT_PAGINATION_SUCCESS":return k(e,t.result)}return e},e.exports=t.default},1523:function(e,t,n){(function(r){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){o.default.bind("File",function(e){if(-1===["doc","spreadsheet","sheet"].indexOf(cow.pageType)){var t=e.data;"create"===e.db_event?p(t)&&f(t)&&l(t,t.userId===cow.currentUser.id):"update"===e.db_event?p(t)&&f(t)&&0==+t.is_delete?l(t):m(s.default.updateFile(t.guid,t)):"sortFiles"===e.db_event&&d(t)}})}function n(){o.default.bind("StarredFile",function(e){var t=e.action,n=e.data;if(["doc","spreadsheet","sheet"].indexOf(window.cow.pageType)<0){var r=cow.listType,i={starred:"create"===t};if("create"===t){if("list"===r||"recent"===r){var a=c(n.fileId);a&&(m(s.default.updateFile(a.guid,i)),u(a.guid,i))}}else{var o=c(n.fileId);o&&("list"===r||"recent"===r?(m(s.default.updateFile(o.guid,i)),u(o.guid,i)):"favorites"===r&&(m(s.default.updateFile(o.guid,{is_delete:1})),u(o.guid,{is_delete:1})))}}})}function i(){o.default.bind("Permission",function(e){var t=cow.listType,n=["recent","favorites"].indexOf(t)<0,r=e.data;if("create"===e.db_event&&n){var i=r.file;f(i)&&void 0===cow.currentFile.id&&(i.user_id===cow.currentUser.id&&1===i.type?l(i,i.userId===cow.currentUser.id):l(i))}else if("destroy"===e.db_event){var a=r.guid,o={};n?o.is_delete=1:o.authorized=!1,m(s.default.updateFile(a,o)),u(a,o)}})}function a(){o.default.bind("Activation",function(e){e.success&&r("#email-verify").remove()})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];1===e.type&&(e.isNew=t),e.authorized=!0,cow.currentFile.children.unshift(e),m(s.default.addFile(e))}function u(e,t){var n=cow.currentFile.children;(n||[]).some(function(r,i){if(r.guid===e){for(var a in t)r[a]=t[a],"is_delete"===a&&+t.is_delete>=1&&n.splice(i,1);return!0}return!1})}function c(e){var t=h.getState().list,n=t.files,r=null;return n&&n.some(function(t){return t.id===e&&(r=t,!0)}),r}function d(e){var t=-1,n=-1,r=-1,i=-1,a=h.getState().list;a.files.forEach(function(n,a){n.guid===e.file?(t=a,i=a):n.guid===e.before&&(r=a)}),n=null===e.before?a.files.length-1:t>=r?r:r-1,a=h.getState().list,i!==n&&!a.isMoving&&t>-1&&n>-1&&m(s.default.moveFile(t,n))}function f(e){return!h.getState().list.files.some(function(t){return t.guid===e.guid})}function p(e){var t=cow.currentFile.id||0;return e.parent_id===t}var h=e,m=e.dispatch;!function(){t(),n(),i(),a()}()};var a=n(33),o=i(a),l=n(1438),s=i(l);e.exports=t.default}).call(t,n(2))},544:function(e,t,n){e.exports=function(){n(74).injection.injectEventPluginsByName({TapEventPlugin:n(550)})}},550:function(e,t,n){"use strict";function r(e,t){var n=u.extractSingleTouch(t);return n?n[e.page]:e.page in t?t[e.page]:t[e.client]+c[e.envScroll]}function i(e,t){var n=r(_.x,t),i=r(_.y,t);return Math.pow(Math.pow(n-e.x,2)+Math.pow(i-e.y,2),.5)}var a=n(35),o=n(264),l=n(75),s=n(76),u=n(551),c=n(180),d=n(49),f=a.topLevelTypes,p=o.isStartish,h=o.isEndish,m=function(e){return[f.topTouchCancel,f.topTouchEnd,f.topTouchStart,f.topTouchMove].indexOf(e)>=0},v=10,y=750,g={x:null,y:null},b=null,_={x:{page:"pageX",client:"clientX",envScroll:"currentPageScrollLeft"},y:{page:"pageY",client:"clientY",envScroll:"currentPageScrollTop"}},w=[f.topTouchStart,f.topTouchCancel,f.topTouchEnd,f.topTouchMove],k=[f.topMouseDown,f.topMouseMove,f.topMouseUp].concat(w),E={touchTap:{phasedRegistrationNames:{bubbled:d({onTouchTap:null}),captured:d({onTouchTapCapture:null})},dependencies:k}},C=function(){return Date.now?Date.now:function(){return+new Date}}(),T={tapMoveThreshold:v,ignoreMouseThreshold:y,eventTypes:E,extractEvents:function(e,t,n,a,o){if(m(e))b=C();else if(b&&C()-b<y)return null;if(!p(e)&&!h(e))return null;var u=null,c=i(g,a);return h(e)&&c<v&&(u=s.getPooled(E.touchTap,n,a,o)),p(e)?(g.x=r(_.x,a),g.y=r(_.y,a)):h(e)&&(g.x=0,g.y=0),l.accumulateTwoPhaseDispatches(u),u}};e.exports=T},551:function(e,t){var n={extractSingleTouch:function(e){var t=e.touches,n=e.changedTouches,r=t&&t.length>0,i=n&&n.length>0;return!r&&i?n[0]:r?t[0]:e}};e.exports=n},922:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"render",value:function(){var e={};return this.props.size&&(e.fontSize=this.props.size+"px"),u.default.createElement("div",{className:"spinner-wrap",style:e},u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}),u.default.createElement("div",{className:"spinner-blade"}))}}],[{key:"propTypes",get:function(){return{size:s.PropTypes.number}}}]),t}(s.Component);t.default=c,e.exports=t.default},923:function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),u=r(s),c=n(922),d=r(c),f=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"render",value:function(){if(this.props.show){var e={backgroundColor:this.props.overlayColor||"transparent",position:"absolute",top:"0",right:"0",bottom:"0",left:"0"};return u.default.createElement("div",{style:e},u.default.createElement(d.default,{size:this.props.size}))}return null}}],[{key:"propTypes",get:function(){return{overlayColor:s.PropTypes.string,show:s.PropTypes.bool,size:s.PropTypes.number}}}]),t}(s.Component);t.default=f,e.exports=t.default}});